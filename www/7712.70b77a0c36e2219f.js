"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7712],{260:(Ws,Bt,X)=>{X.d(Bt,{E:()=>Xe});var _=X(7458),ve=X(5648),d=X(3864);function _t(L,yt){if(1&L&&(_.I0R(0,"ion-label"),_.OEk(1),_.C$Y()),2&L){const Be=_.GaO();_.yG2(),_.cNF(Be.label)}}function Ut(L,yt){if(1&L&&(_.I0R(0,"ion-text",3)(1,"strong"),_.OEk(2),_.C$Y()()),2&L){const Be=_.GaO();_.yG2(2),_.oRS(" ",Be.text," ")}}function Oe(L,yt){if(1&L){const Be=_.KQA();_.I0R(0,"ion-button",4),_.qCj("click",function(){_.usT(Be);const $e=_.GaO();return _.CGJ($e.action($e.parameters))}),_.OEk(1),_.C$Y()}if(2&L){const Be=_.GaO();_.yG2(),_.oRS(" ",Be.actionTitle," ")}}let Xe=(()=>{class L{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(je){return new(je||L)};static#t=this.\u0275cmp=_.In1({type:L,selectors:[["item-component"]],inputs:{label:"label",text:"text",action:"action",actionTitle:"actionTitle",parameters:"parameters"},decls:4,vars:3,consts:[[4,"ngIf"],["class","ion-text-center","color","tertiary",4,"ngIf"],["expand","block","fill","clear","shape","round","slot","end",3,"click",4,"ngIf"],["color","tertiary",1,"ion-text-center"],["expand","block","fill","clear","shape","round","slot","end",3,"click"]],template:function(je,$e){1&je&&(_.I0R(0,"ion-item"),_.yuY(1,_t,2,1,"ion-label",0)(2,Ut,3,1,"ion-text",1)(3,Oe,2,1,"ion-button",2),_.C$Y()),2&je&&(_.yG2(),_.E7m("ngIf",$e.label),_.yG2(),_.E7m("ngIf",$e.text),_.yG2(),_.E7m("ngIf",$e.action))},dependencies:[ve.sn,ve.Yb,ve.QR,ve.Wg,d.u_]})}return L})()},8640:(Ws,Bt,X)=>{X.d(Bt,{$:()=>no});var _=X(1225),ve=X(7576),d=X(7458),_t=X(2692),Ut=X(3264),Oe=X(3864),Xe=X(2644),L=X(5648);function yt(V,be){if(1&V){const S=d.KQA();d.I0R(0,"div",3),d.qCj("click",function(){d.usT(S);const T=d.GaO();return d.CGJ(T.removeItem())}),d.wR5(1,"ion-icon",4),d.C$Y()}}let Be=(()=>{class V{constructor(){this.showButton=!1}ngOnInit(){}removeItem(){this.callback({listName:this.listName,item:this.player})}static#e=this.\u0275fac=function(k){return new(k||V)};static#t=this.\u0275cmp=d.In1({type:V,selectors:[["card-component"]],inputs:{players:"players",player:"player",listName:"listName",callback:"callback",index:"index"},decls:6,vars:4,consts:[[3,"mouseenter","mouseleave"],[3,"alt","src"],["class","deleteButton",3,"click",4,"ngIf"],[1,"deleteButton",3,"click"],["name","trash",1,"ico"]],template:function(k,T){1&k&&(d.I0R(0,"ion-card",0),d.qCj("mouseenter",function(){return T.showButton=!0})("mouseleave",function(){return T.showButton=!1}),d.wR5(1,"img",1),d.yuY(2,yt,2,0,"div",2),d.I0R(3,"ion-card-header")(4,"ion-card-title"),d.OEk(5),d.C$Y()()()),2&k&&(d.yG2(),d.CI5("alt","",T.player," + picture")("src","https://robohash.org/ + ",T.player,"",d.K6U),d.yG2(),d.E7m("ngIf",T.showButton),d.yG2(3),d.oRS(" ",T.player," "))},dependencies:[L.KC,L.YY,L.I7,L.Ko,Oe.u_],styles:["ion-card[_ngcontent-%COMP%]{min-width:200px;max-width:200px;min-height:300px;max-height:300px}ion-card[_ngcontent-%COMP%]:hover   div[_ngcontent-%COMP%]{display:block}ion-icon[_ngcontent-%COMP%]{cursor:pointer}.deleteButton[_ngcontent-%COMP%]{position:absolute;right:2px;top:2px;display:none}.ico[_ngcontent-%COMP%]{width:50px;height:50px}.d-flex[_ngcontent-%COMP%]{display:flex}.overflow-x[_ngcontent-%COMP%]{overflow-x:auto}"]})}return V})();var je=X(260);function $e(V,be){if(1&V){const S=d.KQA();d.I0R(0,"ion-button",2),d.qCj("click",function(){d.usT(S);const T=d.GaO();return d.CGJ(T.addItem())}),d.wR5(1,"ion-icon",3),d.C$Y()}if(2&V){const S=d.GaO();d.yG2(),d._6D("name",S.icon)}}let vc=(()=>{class V{constructor(){this.id="",this.type="text",this.placeholder="Ingresa nuevo ...",this.parameter="",this.icon=null,this.count=20,this.inputModel=""}ngOnInit(){}addItem(){const S=document.getElementById(this.id);if(""===this.inputModel.trim())return S?.focus(),alert("Los campos no deben estar vacios");this.action(this.parameter,this.inputModel),this.inputModel="",S?.focus()}static#e=this.\u0275fac=function(k){return new(k||V)};static#t=this.\u0275cmp=d.In1({type:V,selectors:[["input-component"]],inputs:{id:"id",type:"type",model:"model",placeholder:"placeholder",action:"action",parameter:"parameter",icon:"icon",count:"count"},decls:2,vars:7,consts:[["fill","outline",3,"id","placeholder","ngModel","type","counter","maxlength","ngModelChange","keyup.enter"],["fill","clear","slot","end","aria-label","Show/hide",3,"click",4,"ngIf"],["fill","clear","slot","end","aria-label","Show/hide",3,"click"],["slot","icon-only","aria-hidden","true",3,"name"]],template:function(k,T){1&k&&(d.I0R(0,"ion-input",0),d.iHE("ngModelChange",function(Q){return d.kNx(T.inputModel,Q)||(T.inputModel=Q),Q}),d.qCj("keyup.enter",function(){return T.addItem()}),d.yuY(1,$e,2,1,"ion-button",1),d.C$Y()),2&k&&(d._6D("id",T.id),d._6D("placeholder",T.placeholder),d._6D("type",T.type),d._6D("maxlength",T.count),d.OKB("ngModel",T.inputModel),d.E7m("counter",!0),d.yG2(),d.E7m("ngIf",T.inputModel.trim().length>0))},dependencies:[L.sn,L.Ko,L.A5,L.qG,Oe.u_,Xe.ue,Xe.Mj,Xe._G]})}return V})();function Ti(V,be){1&V&&(d.I0R(0,"ion-label"),d.OEk(1,"* No hay participantes todavia *"),d.C$Y())}function Hs(V,be){if(1&V&&d.wR5(0,"card-component",21),2&V){const S=be.$implicit,k=be.index,T=d.GaO();d.E7m("player",S)("listName","players")("callback",T.removeItem)("index",k)}}function Ys(V,be){if(1&V){const S=d.KQA();d.I0R(0,"div",22)(1,"ion-text",1)(2,"ion-label"),d.OEk(3,"Tiempo:"),d.C$Y()(),d.I0R(4,"ion-row",23)(5,"ion-col",24)(6,"ion-input",25),d.iHE("ngModelChange",function(T){d.usT(S);const K=d.GaO();return d.kNx(K.timer.time.hours,T)||(K.timer.time.hours=T),d.CGJ(T)}),d.qCj("ngModelChange",function(T){d.usT(S);const K=d.GaO();return d.CGJ(K.saveTimer("hours",T))}),d.C$Y()(),d.I0R(7,"ion-col",24)(8,"ion-input",26),d.iHE("ngModelChange",function(T){d.usT(S);const K=d.GaO();return d.kNx(K.timer.time.minuts,T)||(K.timer.time.minuts=T),d.CGJ(T)}),d.qCj("ngModelChange",function(T){d.usT(S);const K=d.GaO();return d.CGJ(K.saveTimer("minuts",T))}),d.C$Y()(),d.I0R(9,"ion-col",24)(10,"ion-input",27),d.iHE("ngModelChange",function(T){d.usT(S);const K=d.GaO();return d.kNx(K.timer.time.seconds,T)||(K.timer.time.seconds=T),d.CGJ(T)}),d.qCj("ngModelChange",function(T){d.usT(S);const K=d.GaO();return d.CGJ(K.saveTimer("seconds",T))}),d.C$Y()()()()}if(2&V){const S=d.GaO();d.yG2(6),d.OKB("ngModel",S.timer.time.hours),d.E7m("counter",!0),d.yG2(2),d.OKB("ngModel",S.timer.time.minuts),d.E7m("counter",!0),d.yG2(2),d.OKB("ngModel",S.timer.time.seconds),d.E7m("counter",!0)}}function Js(V,be){1&V&&(d.I0R(0,"ion-label"),d.OEk(1,"* No hay sitios todavia *"),d.C$Y())}const Xs=V=>({listName:"sites",item:V});function Zs(V,be){if(1&V&&d.wR5(0,"item-component",28),2&V){const S=be.$implicit,k=d.GaO();d.E7m("action",k.removeItem)("actionTitle","Eliminar")("label",S.title)("parameters",d.S45(4,Xs,S))}}function pn(V,be){1&V&&(d.I0R(0,"ion-label"),d.OEk(1,"* No hay situaciones todavia *"),d.C$Y())}const eo=V=>({listName:"situations",item:V});function to(V,be){if(1&V&&d.wR5(0,"item-component",28),2&V){const S=be.$implicit,k=d.GaO();d.E7m("action",k.removeItem)("actionTitle","Eliminar")("label",S.title)("parameters",d.S45(4,eo,S))}}function vi(V,be){1&V&&(d.I0R(0,"ion-label"),d.OEk(1,"* No hay temas todavia *"),d.C$Y())}const Ac=V=>({listName:"temes",item:V});function Ai(V,be){if(1&V&&d.wR5(0,"item-component",28),2&V){const S=be.$implicit,k=d.GaO();d.E7m("action",k.removeItem)("actionTitle","Eliminar")("label",S.title)("parameters",d.S45(4,Ac,S))}}let no=(()=>{class V{constructor(S,k){var T=this;this.store=S,this.fireDatabase=k,this.appTitle="",this.subs=[],this.listSubs=[],this.players=[],this.sites=[],this.situations=[],this.temes=[],this.repeat=!0,this.help=!0,this.timer={isActive:!1,time:{hours:0,minuts:0,seconds:0}},this.num=0,this.addItem=function(){var K=(0,_.c)(function*(Q,Ze){if(""===Ze.trim())return alert("Campos vacios");Q.toLowerCase()!="players".toLowerCase()?yield T.fireDatabase.addNewDocument(Q.toLowerCase(),{title:Ze.trim()}):T.setStore(Q,[...T.players,Ze])});return function(Q,Ze){return K.apply(this,arguments)}}(),this.removeItem=function(){var K=(0,_.c)(function*({listName:Q,item:Ze}){let lr=[];lr=T.listAssign(Q),Q.toLowerCase()!="players".toLowerCase()&&(yield T.fireDatabase.deleteDocument(Q,Ze.id));const gn=[...lr];gn.splice(gn.indexOf(Ze),1),T.setStore(Q,gn)});return function(Q){return K.apply(this,arguments)}}(),this.config$=this.store.select("config")}ngOnInit(){this.getStore(),this.listSubs.push(this.fireDatabase.getCollection("sites").subscribe(S=>{this.sites=S,this.setStore("sites",S)})),this.listSubs.push(this.fireDatabase.getCollection("situations").subscribe(S=>{this.situations=S,this.setStore("situations",S)})),this.listSubs.push(this.fireDatabase.getCollection("temes").subscribe(S=>{this.temes=S,this.setStore("temes",S)}))}ngOnDestroy(){this.subs.forEach(S=>S.unsubscribe())}getStore(){this.subs.push(this.config$.subscribe(({appTitle:S,players:k,sites:T,situations:K,temes:Q,repeat:Ze,help:lr,timer:gn})=>{this.appTitle=S,this.players=k,this.sites=T,this.situations=K,this.temes=Q,this.repeat=Ze,this.help=lr,this.timer=gn}))}setStore(S,k){S.toLowerCase()==="players".toLowerCase()&&this.store.dispatch((0,ve.s9)({players:k})),S.toLowerCase()==="sites".toLowerCase()&&this.store.dispatch((0,ve.uW)({sites:k})),S.toLowerCase()==="situations".toLowerCase()&&this.store.dispatch((0,ve.Ml)({situations:k})),S.toLowerCase()==="temes".toLowerCase()&&this.store.dispatch((0,ve.Av)({temes:k})),S.toLowerCase()==="repeat".toLowerCase()&&this.store.dispatch((0,ve.sr)({repeat:k})),S.toLowerCase()==="help".toLowerCase()&&this.store.dispatch((0,ve.g$)({help:k})),S.toLowerCase()==="timer".toLowerCase()&&this.store.dispatch((0,ve.mI)({timer:k}))}saveTimer(S,k){let T=parseInt(k.replace(/^0+|[^0-9]/g,""));Number.isNaN(T)&&(T=0),"hours"==S&&(this.timer.time.hours=T),"minuts"==S&&(this.timer.time.minuts=T),"seconds"==S&&(this.timer.time.seconds=T),this.setStore("timer",this.timer)}setRepeat(){this.store.dispatch((0,ve.sr)({repeat:!!this.repeat}))}listAssign(S){let k=[];return S.toLowerCase()=="players".toLowerCase()&&(k=this.players),S.toLowerCase()=="sites".toLowerCase()&&(k=this.sites),S.toLowerCase()=="temes".toLowerCase()&&(k=this.temes),S.toLowerCase()=="situations".toLowerCase()&&(k=this.situations),k}static#e=this.\u0275fac=function(k){return new(k||V)(d.GI1(_t.m_),d.GI1(Ut._))};static#t=this.\u0275cmp=d.In1({type:V,selectors:[["config-page"]],decls:89,vars:45,consts:[[3,"translucent"],["color","tertiary"],[3,"fullscreen"],[1,"ion-justify-content-center"],["size","12","size-sm","12","size-md","10","size-lg","8"],["collapse","condense"],["color","tertiary","size","large"],[1,"content-header"],["color","tertiary",1,"content-title"],[1,"content-input"],[3,"id","type","placeholder","action","parameter","icon"],[1,"d-flex","overflow-x"],[4,"ngIf"],[3,"player","listName","callback","index",4,"ngFor","ngForOf"],[1,"pt-2"],[3,"click"],["slot","end",3,"ngModel","ngModelChange"],["class","ion-margin-top",4,"ngIf"],[3,"id","type","placeholder","action","parameter","icon","count"],[1,"pt-2","h-list"],[3,"action","actionTitle","label","parameters",4,"ngFor","ngForOf"],[3,"player","listName","callback","index"],[1,"ion-margin-top"],[1,"between"],["size","10","size-md","3",1,"ion-margin"],["id","hours","label","Horas","label-placement","floating","fill","outline","type","text","placeholder","Horas","maxlength","2",3,"ngModel","counter","ngModelChange"],["id","minuts","label","Minutos","label-placement","floating","fill","outline","type","text","placeholder","Minutos","maxlength","2",3,"ngModel","counter","ngModelChange"],["id","seconds","label","Segundos","label-placement","floating","fill","outline","type","text","placeholder","Segundos","maxlength","2",3,"ngModel","counter","ngModelChange"],[3,"action","actionTitle","label","parameters"]],template:function(k,T){1&k&&(d.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title",1),d.OEk(3,"CONFIGURACION"),d.C$Y()()(),d.I0R(4,"ion-content",2)(5,"ion-row",3)(6,"ion-col",4)(7,"ion-header",5)(8,"ion-toolbar")(9,"ion-card-subtitle"),d.OEk(10),d.C$Y(),d.I0R(11,"ion-card-title",6),d.OEk(12,"CONFIGURACION"),d.C$Y()()(),d.I0R(13,"ion-card")(14,"ion-card-content")(15,"ion-text")(16,"p"),d.OEk(17,"Aqu\xed puedes agregar participantes, marcos de circunstancias para la predicaci\xf3n, temas de conversaci\xf3n y los diferentes territorios donde quieres practicar."),d.C$Y(),d.I0R(18,"p"),d.OEk(19,"Que te diviertas!"),d.C$Y()()()(),d.I0R(20,"ion-card")(21,"ion-card-content")(22,"div",7)(23,"ion-text",8)(24,"h1"),d.OEk(25,"Jugadores"),d.C$Y()(),d.I0R(26,"div",9),d.wR5(27,"input-component",10),d.C$Y()(),d.I0R(28,"div",11),d.yuY(29,Ti,2,0,"ion-label",12)(30,Hs,1,4,"card-component",13),d.C$Y()()(),d.I0R(31,"ion-card")(32,"ion-card-content")(33,"div",14)(34,"ion-item",15),d.qCj("click",function(){return T.setStore("repeat",T.repeat)}),d.I0R(35,"ion-label"),d.OEk(36,"Repetir participantes"),d.C$Y(),d.I0R(37,"ion-checkbox",16),d.iHE("ngModelChange",function(Q){return d.kNx(T.repeat,Q)||(T.repeat=Q),Q}),d.C$Y()(),d.I0R(38,"ion-item",15),d.qCj("click",function(){return T.setStore("help",T.help)}),d.I0R(39,"ion-label"),d.OEk(40,"Activar ayuda"),d.C$Y(),d.I0R(41,"ion-checkbox",16),d.iHE("ngModelChange",function(Q){return d.kNx(T.help,Q)||(T.help=Q),Q}),d.C$Y()(),d.I0R(42,"ion-item",15),d.qCj("click",function(){return T.setStore("timer",T.timer)}),d.I0R(43,"ion-label"),d.OEk(44,"Activar cronometro"),d.C$Y(),d.I0R(45,"ion-checkbox",16),d.iHE("ngModelChange",function(Q){return d.kNx(T.timer.isActive,Q)||(T.timer.isActive=Q),Q}),d.C$Y()(),d.yuY(46,Ys,11,6,"div",17),d.C$Y()()(),d.I0R(47,"ion-card")(48,"ion-card-content")(49,"div",7)(50,"ion-text",8)(51,"h1"),d.OEk(52,"Sitios"),d.C$Y()(),d.I0R(53,"div",9),d.wR5(54,"input-component",18),d.C$Y()(),d.I0R(55,"div",19),d.yuY(56,Js,2,0,"ion-label",12)(57,Zs,1,6,"item-component",20),d.C$Y(),d.I0R(58,"div")(59,"ion-label"),d.OEk(60),d.C$Y()()()(),d.I0R(61,"ion-card")(62,"ion-card-content")(63,"div",7)(64,"ion-text",8)(65,"h1"),d.OEk(66,"Situaciones"),d.C$Y()(),d.I0R(67,"div",9),d.wR5(68,"input-component",18),d.C$Y()(),d.I0R(69,"div",19),d.yuY(70,pn,2,0,"ion-label",12)(71,to,1,6,"item-component",20),d.C$Y(),d.I0R(72,"div")(73,"ion-label"),d.OEk(74),d.C$Y()()()(),d.I0R(75,"ion-card")(76,"ion-card-content")(77,"div",7)(78,"ion-text",8)(79,"h1"),d.OEk(80,"Temas"),d.C$Y()(),d.I0R(81,"div",9),d.wR5(82,"input-component",18),d.C$Y()(),d.I0R(83,"div",19),d.yuY(84,vi,2,0,"ion-label",12)(85,Ai,1,6,"item-component",20),d.C$Y(),d.I0R(86,"div")(87,"ion-label"),d.OEk(88),d.C$Y()()()()()()()),2&k&&(d.E7m("translucent",!0),d.yG2(4),d.E7m("fullscreen",!0),d.yG2(6),d.cNF(T.appTitle),d.yG2(17),d.E7m("id","players")("type","text")("placeholder","Agrega m\xe1s aqu\xed.")("action",T.addItem)("parameter","players")("icon","add-circle"),d.yG2(2),d.E7m("ngIf",0==T.players.length),d.yG2(),d.E7m("ngForOf",T.players),d.yG2(7),d.OKB("ngModel",T.repeat),d.yG2(4),d.OKB("ngModel",T.help),d.yG2(4),d.OKB("ngModel",T.timer.isActive),d.yG2(),d.E7m("ngIf",T.timer.isActive),d.yG2(8),d.E7m("id","sites")("type","text")("placeholder","Agrega m\xe1s aqu\xed.")("action",T.addItem)("parameter","sites")("icon","add-circle")("count",30),d.yG2(2),d.E7m("ngIf",0==T.sites.length),d.yG2(),d.E7m("ngForOf",T.sites),d.yG2(3),d.oRS(" ",T.sites.length," sitios "),d.yG2(8),d.E7m("id","situations")("type","text")("placeholder","Agrega m\xe1s aqu\xed.")("action",T.addItem)("parameter","situations")("icon","add-circle")("count",30),d.yG2(2),d.E7m("ngIf",0==T.situations.length),d.yG2(),d.E7m("ngForOf",T.situations),d.yG2(3),d.oRS(" ",T.situations.length," situaciones "),d.yG2(8),d.E7m("id","temes")("type","text")("placeholder","Agrega m\xe1s aqu\xed.")("action",T.addItem)("parameter","temes")("icon","add-circle")("count",30),d.yG2(2),d.E7m("ngIf",0==T.temes.length),d.yG2(),d.E7m("ngForOf",T.temes),d.yG2(3),d.oRS(" ",T.temes.length," temas "))},dependencies:[Oe.ay,Oe.u_,Xe.ue,Xe.Mj,Xe._G,L.KC,L.Gg,L.MN,L.I7,L.ew,L.Kk,L._i,L.wB,L.A5,L.Yb,L.QR,L.qo,L.Wg,L.tM,L.Md,L.UJ,L.qG,Be,je.E,vc],styles:[".d-flex[_ngcontent-%COMP%]{display:flex}.between[_ngcontent-%COMP%]{justify-content:space-between}.align-center[_ngcontent-%COMP%]{align-items:center}.overflow-x[_ngcontent-%COMP%]{overflow-x:auto}.overflow-y[_ngcontent-%COMP%]{overflow-y:auto}.grid[_ngcontent-%COMP%]{max-height:10%}.content-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.content-title[_ngcontent-%COMP%]{display:flex;align-items:center;transform:translateY(-10px);width:30%}.content-input[_ngcontent-%COMP%]{width:60%}.timer-config[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:end}.pt-2[_ngcontent-%COMP%]{padding-top:15px!important}.h-list[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto;margin-top:5px;margin-bottom:5px}"]})}return V})()},3264:(Ws,Bt,X)=>{X.d(Bt,{_:()=>DE});var _=X(1225),ve=X(6004);const Oe=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=63&i|128):55296==(64512&i)&&r+1<n.length&&56320==(64512&n.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&n.charCodeAt(++r)),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=63&i|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=63&i|128)}return e},L={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],o=i+1<n.length,a=o?n[i+1]:0,u=i+2<n.length,c=u?n[i+2]:0;let f=(15&a)<<2|c>>6,p=63&c;u||(p=64,o||(f=64)),r.push(t[s>>2],t[(3&s)<<4|a>>4],t[f],t[p])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Oe(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const u=((7&i)<<18|(63&n[t++])<<12|(63&n[t++])<<6|63&n[t++])-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(1023&u))}else{const s=n[t++],o=n[t++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;const c=i<n.length?t[n.charAt(i)]:64;++i;const h=i<n.length?t[n.charAt(i)]:64;if(++i,null==s||null==a||null==c||null==h)throw new yt;r.push(s<<2|a>>4),64!==c&&(r.push(a<<4&240|c>>2),64!==h&&r.push(c<<6&192|h))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class yt extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const je=function(n){return function(n){const e=Oe(n);return L.encodeByteArray(e,!0)}(n).replace(/\./g,"")},pn=()=>{try{return function Ys(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const n=process.env.__FIREBASE_DEFAULTS__;return n?JSON.parse(n):void 0})()||(()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&function(n){try{return L.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(n[1]);return e&&JSON.parse(e)})()}catch(n){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`)}},vi=()=>{var n;return null===(n=pn())||void 0===n?void 0:n.config};class Ai{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function V(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Rc(){try{return"object"==typeof indexedDB}catch{return!1}}class _n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,_n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Pc.prototype.create)}}class Pc{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?function bm(n,e){return n.replace(Cm,(t,r)=>{const i=e[r];return null!=i?String(i):`<${r}?>`})}(s,r):"Error";return new _n(i,`${this.serviceName}: ${o} (${i}).`,r)}}const Cm=/\{\$([^}]+)}/g;function hr(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],o=e[i];if(bc(s)&&bc(o)){if(!hr(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function bc(n){return null!==n&&"object"==typeof n}function Ke(n){return n&&n._delegate?n._delegate:n}class dr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Gt="[DEFAULT]";class Fm{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Ai;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e?.identifier),i=null!==(t=e?.optional)&&void 0!==t&&t;if(!this.isInitialized(r)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function Bm(n){return"EAGER"===n.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Gt})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=Gt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){var e=this;return(0,_.c)(function*(){const t=Array.from(e.instances.values());yield Promise.all([...t.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...t.filter(r=>"_delete"in r).map(r=>r._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(e=Gt){return this.instances.has(e)}getOptions(e=Gt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,o]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(s)&&o.resolve(i);return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),s=null!==(r=this.onInitCallbacks.get(i))&&void 0!==r?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===Gt?void 0:n),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}var n;return r||null}normalizeInstanceIdentifier(e=Gt){return this.component?this.component.multipleInstances?e:Gt:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Um{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Fm(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const so=[];var j=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(j||{});const Cc={debug:j.DEBUG,verbose:j.VERBOSE,info:j.INFO,warn:j.WARN,error:j.ERROR,silent:j.SILENT},Gm=j.INFO,qm={[j.DEBUG]:"log",[j.VERBOSE]:"log",[j.INFO]:"info",[j.WARN]:"warn",[j.ERROR]:"error"},zm=(n,e,...t)=>{if(e<n.logLevel)return;const r=(new Date).toISOString(),i=qm[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${n.name}:`,...t)};class xc{constructor(e){this.name=e,this._logLevel=Gm,this._logHandler=zm,this._userLogHandler=null,so.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in j))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Cc[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,j.DEBUG,...e),this._logHandler(this,j.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,j.VERBOSE,...e),this._logHandler(this,j.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,j.INFO,...e),this._logHandler(this,j.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,j.WARN,...e),this._logHandler(this,j.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,j.ERROR,...e),this._logHandler(this,j.ERROR,...e)}}const jm=(n,e)=>e.some(t=>n instanceof t);let Vc,Dc;const Nc=new WeakMap,oo=new WeakMap,kc=new WeakMap,ao=new WeakMap,uo=new WeakMap;let co={get(n,e,t){if(n instanceof IDBTransaction){if("done"===e)return oo.get(n);if("objectStoreNames"===e)return n.objectStoreNames||kc.get(n);if("store"===e)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return It(n[e])},set:(n,e,t)=>(n[e]=t,!0),has:(n,e)=>n instanceof IDBTransaction&&("done"===e||"store"===e)||e in n};function Jm(n){return"function"==typeof n?function Ym(n){return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function Km(){return Dc||(Dc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(n)?function(...e){return n.apply(lo(this),e),It(Nc.get(this))}:function(...e){return It(n.apply(lo(this),e))}:function(e,...t){const r=n.call(lo(this),e,...t);return kc.set(r,e.sort?e.sort():[e]),It(r)}}(n):(n instanceof IDBTransaction&&function Wm(n){if(oo.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});oo.set(n,e)}(n),jm(n,function $m(){return Vc||(Vc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(n,co):n)}function It(n){if(n instanceof IDBRequest)return function Qm(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(It(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Nc.set(t,n)}).catch(()=>{}),uo.set(e,n),e}(n);if(ao.has(n))return ao.get(n);const e=Jm(n);return e!==n&&(ao.set(n,e),uo.set(e,n)),e}const lo=n=>uo.get(n),Zm=["get","getKey","getAll","getAllKeys","count"],ep=["put","add","delete","clear"],ho=new Map;function Mc(n,e){if(!(n instanceof IDBDatabase)||e in n||"string"!=typeof e)return;if(ho.get(e))return ho.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=ep.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Zm.includes(t))return;const s=function(){var o=(0,_.c)(function*(a,...u){const c=this.transaction(a,i?"readwrite":"readonly");let l=c.store;return r&&(l=l.index(u.shift())),(yield Promise.all([l[t](...u),i&&c.done]))[0]});return function(u){return o.apply(this,arguments)}}();return ho.set(e,s),s}!function Hm(n){co=n(co)}(n=>({...n,get:(e,t,r)=>Mc(e,t)||n.get(e,t,r),has:(e,t)=>!!Mc(e,t)||n.has(e,t)}));class tp{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function np(n){const e=n.getComponent();return"VERSION"===e?.type}(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}return null}).filter(t=>t).join(" ")}}const fo="@firebase/app",qt=new xc("@firebase/app"),Ri="[DEFAULT]",bp={[fo]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},zt=new Map,Pi=new Map;function Cp(n,e){try{n.container.addComponent(e)}catch(t){qt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Si(n){const e=n.name;if(Pi.has(e))return qt.debug(`There were multiple attempts to register component ${e}.`),!1;Pi.set(e,n);for(const t of zt.values())Cp(t,n);return!0}const ut=new Pc("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Vp{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new dr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ut.create("app-deleted",{appName:this._name})}}function Lc(n,e={}){let t=n;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:Ri,automaticDataCollectionEnabled:!1},e),i=r.name;if("string"!=typeof i||!i)throw ut.create("bad-app-name",{appName:String(i)});if(t||(t=vi()),!t)throw ut.create("no-options");const s=zt.get(i);if(s){if(hr(t,s.options)&&hr(r,s.config))return s;throw ut.create("duplicate-app",{appName:i})}const o=new Um(i);for(const u of Pi.values())o.addComponent(u);const a=new Vp(t,r,o);return zt.set(i,a),a}function yn(n,e,t){var r;let i=null!==(r=bp[n])&&void 0!==r?r:n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];return s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void qt.warn(a.join(" "))}Si(new dr(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const kp="firebase-heartbeat-database",Mp=1,fr="firebase-heartbeat-store";let po=null;function Bc(){return po||(po=function Xm(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(n,e),a=It(o);return r&&o.addEventListener("upgradeneeded",u=>{r(It(o.result),u.oldVersion,u.newVersion,It(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),a.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}(kp,Mp,{upgrade:(n,e)=>{if(0===e)try{n.createObjectStore(fr)}catch(t){console.warn(t)}}}).catch(n=>{throw ut.create("idb-open",{originalErrorMessage:n.message})})),po}function go(){return(go=(0,_.c)(function*(n){try{const t=(yield Bc()).transaction(fr),r=yield t.objectStore(fr).get(Gc(n));return yield t.done,r}catch(e){if(e instanceof _n)qt.warn(e.message);else{const t=ut.create("idb-get",{originalErrorMessage:e?.message});qt.warn(t.message)}}})).apply(this,arguments)}function Uc(n,e){return _o.apply(this,arguments)}function _o(){return(_o=(0,_.c)(function*(n,e){try{const r=(yield Bc()).transaction(fr,"readwrite");yield r.objectStore(fr).put(e,Gc(n)),yield r.done}catch(t){if(t instanceof _n)qt.warn(t.message);else{const r=ut.create("idb-set",{originalErrorMessage:t?.message});qt.warn(r.message)}}})).apply(this,arguments)}function Gc(n){return`${n.name}!${n.options.appId}`}class Bp{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Gp(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){var e=this;return(0,_.c)(function*(){var t,r;const s=e.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=qc();if((null!=(null===(t=e._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(e._heartbeatsCache=yield e._heartbeatsCachePromise,null!=(null===(r=e._heartbeatsCache)||void 0===r?void 0:r.heartbeats)))&&e._heartbeatsCache.lastSentHeartbeatDate!==o&&!e._heartbeatsCache.heartbeats.some(a=>a.date===o))return e._heartbeatsCache.heartbeats.push({date:o,agent:s}),e._heartbeatsCache.heartbeats=e._heartbeatsCache.heartbeats.filter(a=>{const u=new Date(a.date).valueOf();return Date.now()-u<=2592e6}),e._storage.overwrite(e._heartbeatsCache)})()}getHeartbeatsHeader(){var e=this;return(0,_.c)(function*(){var t;if(null===e._heartbeatsCache&&(yield e._heartbeatsCachePromise),null==(null===(t=e._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===e._heartbeatsCache.heartbeats.length)return"";const r=qc(),{heartbeatsToSend:i,unsentEntries:s}=function Up(n,e=1024){const t=[];let r=n.slice();for(const i of n){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),zc(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),zc(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}(e._heartbeatsCache.heartbeats),o=je(JSON.stringify({version:2,heartbeats:i}));return e._heartbeatsCache.lastSentHeartbeatDate=r,s.length>0?(e._heartbeatsCache.heartbeats=s,yield e._storage.overwrite(e._heartbeatsCache)):(e._heartbeatsCache.heartbeats=[],e._storage.overwrite(e._heartbeatsCache)),o})()}}function qc(){return(new Date).toISOString().substring(0,10)}class Gp{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,_.c)(function*(){return!!Rc()&&function Pm(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e((null===(s=i.error)||void 0===s?void 0:s.message)||"")}}catch(t){e(t)}})}().then(()=>!0).catch(()=>!1)})()}read(){var e=this;return(0,_.c)(function*(){if(yield e._canUseIndexedDBPromise){const r=yield function Op(n){return go.apply(this,arguments)}(e.app);return r?.heartbeats?r:{heartbeats:[]}}return{heartbeats:[]}})()}overwrite(e){var t=this;return(0,_.c)(function*(){var r;if(yield t._canUseIndexedDBPromise){const s=yield t.read();return Uc(t.app,{lastSentHeartbeatDate:null!==(r=e.lastSentHeartbeatDate)&&void 0!==r?r:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})()}add(e){var t=this;return(0,_.c)(function*(){var r;if(yield t._canUseIndexedDBPromise){const s=yield t.read();return Uc(t.app,{lastSentHeartbeatDate:null!==(r=e.lastSentHeartbeatDate)&&void 0!==r?r:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}})()}}function zc(n){return je(JSON.stringify({version:2,heartbeats:n})).length}!function qp(n){Si(new dr("platform-logger",e=>new tp(e),"PRIVATE")),Si(new dr("heartbeat",e=>new Bp(e),"PRIVATE")),yn(fo,"0.9.27",n),yn(fo,"0.9.27","esm2017"),yn("fire-js","")}(""),yn("firebase","10.8.0","app");var P,$p=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ye={},yo=yo||{},O=$p||self;function bi(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function mr(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Io="closure_uid_"+(1e9*Math.random()>>>0),Qp=0;function Wp(n,e,t){return n.call.apply(n.bind,arguments)}function Hp(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Ce(n,e,t){return(Ce=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Wp:Hp).apply(null,arguments)}function Ci(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function _e(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Et(){this.s=this.s,this.o=this.o}Et.prototype.s=!1,Et.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function Kp(n){Object.prototype.hasOwnProperty.call(n,Io)&&n[Io]||(n[Io]=++Qp)}(this)},Et.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const jc=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Eo(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function $c(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(bi(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function xe(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}xe.prototype.h=function(){this.defaultPrevented=!0};var Jp=function(){if(!O.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const t=()=>{};O.addEventListener("test",t,e),O.removeEventListener("test",t,e)}catch{}return n}();function pr(n){return/^[\s\xa0]*$/.test(n)}function xi(){var n=O.navigator;return n&&(n=n.userAgent)?n:""}function et(n){return-1!=xi().indexOf(n)}function To(n){return To[" "](n),n}To[" "]=function(){};var Ao,n,Zp=et("Opera"),In=et("Trident")||et("MSIE"),Kc=et("Edge"),vo=Kc||In,Qc=et("Gecko")&&!(-1!=xi().toLowerCase().indexOf("webkit")&&!et("Edge"))&&!(et("Trident")||et("MSIE"))&&!et("Edge"),eg=-1!=xi().toLowerCase().indexOf("webkit")&&!et("Edge");function Wc(){var n=O.document;return n?n.documentMode:void 0}e:{var wo="",Ro=(n=xi(),Qc?/rv:([^\);]+)(\)|;)/.exec(n):Kc?/Edge\/([\d\.]+)/.exec(n):In?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):eg?/WebKit\/(\S+)/.exec(n):Zp?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Ro&&(wo=Ro?Ro[1]:""),In){var Po=Wc();if(null!=Po&&Po>parseFloat(wo)){Ao=String(Po);break e}}Ao=wo}var tg=O.document&&In&&(Wc()||parseInt(Ao,10))||void 0;function gr(n,e){if(xe.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Qc){e:{try{To(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:ng[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&gr.$.h.call(this)}}_e(gr,xe);var ng={2:"touch",3:"pen",4:"mouse"};gr.prototype.h=function(){gr.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var _r="closure_listenable_"+(1e6*Math.random()|0),rg=0;function ig(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++rg,this.fa=this.ia=!1}function Vi(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function bo(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function Yc(n){const e={};for(const t in n)e[t]=n[t];return e}const Jc="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Xc(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<Jc.length;s++)t=Jc[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Di(n){this.src=n,this.g={},this.h=0}function Co(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=jc(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Vi(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function xo(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}Di.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=xo(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new ig(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var Vo="closure_lm_"+(1e6*Math.random()|0),Do={};function Zc(n,e,t,r,i){if(r&&r.once)return tl(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Zc(n,e[s],t,r,i);return null}return t=Oo(t),n&&n[_r]?n.O(e,t,mr(r)?!!r.capture:!!r,i):el(n,e,t,!1,r,i)}function el(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=mr(i)?!!i.capture:!!i,a=ko(n);if(a||(n[Vo]=a=new Di(n)),(t=a.add(e,t,r,o,s)).proxy)return t;if(r=function og(){const e=ag;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)Jp||(i=o),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(rl(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function tl(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)tl(n,e[s],t,r,i);return null}return t=Oo(t),n&&n[_r]?n.P(e,t,mr(r)?!!r.capture:!!r,i):el(n,e,t,!0,r,i)}function nl(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)nl(n,e[s],t,r,i);else r=mr(r)?!!r.capture:!!r,t=Oo(t),n&&n[_r]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=xo(s=n.g[e],t,r,i))&&(Vi(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=ko(n))&&(e=n.g[e.toString()],n=-1,e&&(n=xo(e,t,r,i)),(t=-1<n?e[n]:null)&&No(t))}function No(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[_r])Co(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(rl(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=ko(e))?(Co(t,n),0==t.h&&(t.src=null,e[Vo]=null)):Vi(n)}}}function rl(n){return n in Do?Do[n]:Do[n]="on"+n}function ag(n,e){if(n.fa)n=!0;else{e=new gr(e,this);var t=n.listener,r=n.la||n.src;n.ia&&No(n),n=t.call(r,e)}return n}function ko(n){return(n=n[Vo])instanceof Di?n:null}var Mo="__closure_events_fn_"+(1e9*Math.random()>>>0);function Oo(n){return"function"==typeof n?n:(n[Mo]||(n[Mo]=function(e){return n.handleEvent(e)}),n[Mo])}function ye(){Et.call(this),this.i=new Di(this),this.S=this,this.J=null}function Ae(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new xe(e,n);else if(e instanceof xe)e.target=e.target||n;else{var i=e;Xc(e=new xe(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=Ni(o,r,!0,e)&&i}if(i=Ni(o=e.g=n,r,!0,e)&&i,i=Ni(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=Ni(o=e.g=t[s],r,!1,e)&&i}function Ni(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&Co(n.i,o),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}_e(ye,Et),ye.prototype[_r]=!0,ye.prototype.removeEventListener=function(n,e,t,r){nl(this,n,e,t,r)},ye.prototype.N=function(){if(ye.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Vi(t[r]);delete n.g[e],n.h--}}this.J=null},ye.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},ye.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var Fo=O.JSON.stringify;function cg(){var n=Lo;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var il=new class ug{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new hg,n=>n.reset());class hg{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function dg(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function fg(n){O.setTimeout(()=>{throw n},0)}let yr,Ir=!1,Lo=new class lg{constructor(){this.h=this.g=null}add(e,t){const r=il.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},sl=()=>{const n=O.Promise.resolve(void 0);yr=()=>{n.then(mg)}};var mg=()=>{for(var n;n=cg();){try{n.h.call(n.g)}catch(t){fg(t)}var e=il;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Ir=!1};function ki(n,e){ye.call(this),this.h=n||1,this.g=e||O,this.j=Ce(this.qb,this),this.l=Date.now()}function Bo(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function Uo(n,e,t){if("function"==typeof n)t&&(n=Ce(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=Ce(n.handleEvent,n)}return 2147483647<Number(e)?-1:O.setTimeout(n,e||0)}function ol(n){n.g=Uo(()=>{n.g=null,n.i&&(n.i=!1,ol(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}_e(ki,ye),(P=ki.prototype).ga=!1,P.T=null,P.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ae(this,"tick"),this.ga&&(Bo(this),this.start()))}},P.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},P.N=function(){ki.$.N.call(this),Bo(this),delete this.g};class pg extends Et{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:ol(this)}N(){super.N(),this.g&&(O.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Er(n){Et.call(this),this.h=n,this.g={}}_e(Er,Et);var al=[];function ul(n,e,t,r){Array.isArray(t)||(t&&(al[0]=t.toString()),t=al);for(var i=0;i<t.length;i++){var s=Zc(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function cl(n){bo(n.g,function(e,t){this.g.hasOwnProperty(t)&&No(e)},n),n.g={}}function Mi(){this.g=!0}function En(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Ig(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Fo(t)}catch{return e}}(n,t)+(r?" "+r:"")})}Er.prototype.N=function(){Er.$.N.call(this),cl(this)},Er.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Mi.prototype.Ea=function(){this.g=!1},Mi.prototype.info=function(){};var jt={},ll=null;function Oi(){return ll=ll||new ye}function hl(n){xe.call(this,jt.Ta,n)}function Tr(n){const e=Oi();Ae(e,new hl(e))}function dl(n,e){xe.call(this,jt.STAT_EVENT,n),this.stat=e}function ke(n){const e=Oi();Ae(e,new dl(e,n))}function fl(n,e){xe.call(this,jt.Ua,n),this.size=e}function vr(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return O.setTimeout(function(){n()},e)}jt.Ta="serverreachability",_e(hl,xe),jt.STAT_EVENT="statevent",_e(dl,xe),jt.Ua="timingevent",_e(fl,xe);var Fi={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ml={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Go(){}function gl(){}Go.prototype.h=null;var jo,Ar={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function qo(){xe.call(this,"d")}function zo(){xe.call(this,"c")}function Li(){}function wr(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Er(this),this.P=Eg,this.V=new ki(n=vo?125:void 0),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new _l}function _l(){this.i=null,this.g="",this.h=!1}_e(qo,xe),_e(zo,xe),_e(Li,Go),Li.prototype.g=function(){return new XMLHttpRequest},Li.prototype.i=function(){return{}},jo=new Li;var Eg=45e3,yl={},$o={};function Ko(n,e,t){n.L=1,n.A=qi(ct(e)),n.u=t,n.S=!0,Il(n,null)}function Il(n,e){n.G=Date.now(),Rr(n),n.B=ct(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Cl(t.i,"t",r),n.o=0,t=n.l.J,n.h=new _l,n.g=Zl(n.l,t?e:null,!n.u),0<n.O&&(n.M=new pg(Ce(n.Pa,n,n.g),n.O)),ul(n.U,n.g,"readystatechange",n.nb),e=n.I?Yc(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),Tr(),function gg(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.v,n.B,n.m,n.W,n.u)}function El(n){return!!n.g&&"GET"==n.v&&2!=n.L&&n.l.Ha}function Tl(n,e,t){let i,r=!0;for(;!n.J&&n.o<t.length;){if(i=Tg(n,t),i==$o){4==e&&(n.s=4,ke(14),r=!1),En(n.j,n.m,null,"[Incomplete Response]");break}if(i==yl){n.s=4,ke(15),En(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}En(n.j,n.m,i,null),Qo(n,i)}El(n)&&0!=n.o&&(n.h.g=n.h.g.slice(n.o),n.o=0),4!=e||0!=t.length||n.h.h||(n.s=1,ke(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),ea(e),e.M=!0,ke(11))):(En(n.j,n.m,t,"[Invalid Chunked Response]"),$t(n),Pr(n))}function Tg(n,e){var t=n.o,r=e.indexOf("\n",t);return-1==r?$o:(t=Number(e.substring(t,r)),isNaN(t)?yl:(r+=1)+t>e.length?$o:(e=e.slice(r,r+t),n.o=r+t,e))}function Rr(n){n.Y=Date.now()+n.P,vl(n,n.P)}function vl(n,e){if(null!=n.C)throw Error("WatchDog timer not null");n.C=vr(Ce(n.lb,n),e)}function Bi(n){n.C&&(O.clearTimeout(n.C),n.C=null)}function Pr(n){0==n.l.H||n.J||Hl(n.l,n)}function $t(n){Bi(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,Bo(n.V),cl(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Qo(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||Wo(t.i,n)))if(!n.K&&Wo(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;Wi(t),Ki(t)}Zo(t),ke(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=vr(Ce(t.ib,t),6e3));if(1>=Dl(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Qt(t,11)}else if((n.K||t.g==n)&&Wi(t),!pr(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],2==t.H)if("c"==c[0]){t.K=c[1],t.pa=c[2];const l=c[3];null!=l&&(t.ra=l,t.l.info("VER="+t.ra));const h=c[4];null!=h&&(t.Ga=h,t.l.info("SVER="+t.Ga));const f=c[5];null!=f&&"number"==typeof f&&0<f&&(t.L=r=1.5*f,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const p=n.g;if(p){const E=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(E){var s=r.i;s.g||-1==E.indexOf("spdy")&&-1==E.indexOf("quic")&&-1==E.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Ho(s,s.h),s.h=null))}if(r.F){const w=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;w&&(r.Da=w,ne(r.I,r.F,w))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((r=t).wa=Xl(r,r.J?r.pa:null,r.Y),o.K){Nl(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(Bi(a),Rr(a)),r.g=o}else Ql(r);0<t.j.length&&Qi(t)}else"stop"!=c[0]&&"close"!=c[0]||Qt(t,7);else 3==t.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Qt(t,7):Xo(t):"noop"!=c[0]&&t.h&&t.h.Aa(c),t.A=0)}Tr()}catch{}}function Al(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(bi(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function Ag(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(bi(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function vg(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(bi(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(P=wr.prototype).setTimeout=function(n){this.P=n},P.nb=function(n){n=n.target;const e=this.M;e&&3==tt(n)?e.l():this.Pa(n)},P.Pa=function(n){try{if(n==this.g)e:{const l=tt(this.g);var e=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||vo||this.g&&(this.h.h||this.g.ja()||Gl(this.g)))){this.J||4!=l||7==e||Tr(),Bi(this);var t=this.g.da();this.ca=t;t:if(El(this)){var r=Gl(this.g);n="";var i=r.length,s=4==tt(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){$t(this),Pr(this);var o="";break t}this.h.i=new O.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function _g(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+o})}(this.j,this.v,this.B,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!pr(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.s=3,ke(12),$t(this),Pr(this);break e}En(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qo(this,t)}this.S?(Tl(this,l,o),vo&&this.i&&3==l&&(ul(this.U,this.V,"tick",this.mb),this.V.start())):(En(this.j,this.m,o,null),Qo(this,o)),4==l&&$t(this),this.i&&!this.J&&(4==l?Hl(this.l,this):(this.i=!1,Rr(this)))}else(function Gg(n){const e={};n=(n.g&&2<=tt(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(pr(n[r]))continue;var t=dg(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function sg(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.s=3,ke(12)):(this.s=0,ke(13)),$t(this),Pr(this)}}}catch{}},P.mb=function(){if(this.g){var n=tt(this.g),e=this.g.ja();this.o<e.length&&(Bi(this),Tl(this,n,e),this.i&&4!=n&&Rr(this))}},P.cancel=function(){this.J=!0,$t(this)},P.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(function yg(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.B),2!=this.L&&(Tr(),ke(17)),$t(this),this.s=2,Pr(this)):vl(this,this.Y-n)};var wl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Kt(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Kt){this.h=n.h,Ui(this,n.j),this.s=n.s,this.g=n.g,Gi(this,n.m),this.l=n.l;var e=n.i,t=new Cr;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Rl(this,t),this.o=n.o}else n&&(e=String(n).match(wl))?(this.h=!1,Ui(this,e[1]||"",!0),this.s=Sr(e[2]||""),this.g=Sr(e[3]||"",!0),Gi(this,e[4]),this.l=Sr(e[5]||"",!0),Rl(this,e[6]||"",!0),this.o=Sr(e[7]||"")):(this.h=!1,this.i=new Cr(null,this.h))}function ct(n){return new Kt(n)}function Ui(n,e,t){n.j=t?Sr(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Gi(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Rl(n,e,t){e instanceof Cr?(n.i=e,function xg(n,e){e&&!n.j&&(Tt(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Sl(this,r),Cl(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=br(e,bg)),n.i=new Cr(e,n.h))}function ne(n,e,t){n.i.set(e,t)}function qi(n){return ne(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Sr(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function br(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Rg),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Rg(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Kt.prototype.toString=function(){var n=[],e=this.j;e&&n.push(br(e,Pl,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(br(e,Pl,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(br(t,"/"==t.charAt(0)?Sg:Pg,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",br(t,Cg)),n.join("")};var Pl=/[#\/\?@]/g,Pg=/[#\?:]/g,Sg=/[#\?]/g,bg=/[#\?@]/g,Cg=/#/g;function Cr(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Tt(n){n.g||(n.g=new Map,n.h=0,n.i&&function wg(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Sl(n,e){Tt(n),e=Tn(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function bl(n,e){return Tt(n),e=Tn(n,e),n.g.has(e)}function Cl(n,e,t){Sl(n,e),0<t.length&&(n.i=null,n.g.set(Tn(n,e),Eo(t)),n.h+=t.length)}function Tn(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}(P=Cr.prototype).add=function(n,e){Tt(this),this.i=null,n=Tn(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},P.forEach=function(n,e){Tt(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},P.ta=function(){Tt(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},P.Z=function(n){Tt(this);let e=[];if("string"==typeof n)bl(this,n)&&(e=e.concat(this.g.get(Tn(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},P.set=function(n,e){return Tt(this),this.i=null,bl(this,n=Tn(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},P.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},P.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};var Vg=class{constructor(n,e){this.g=n,this.map=e}};function xl(n){this.l=n||Dg,n=O.PerformanceNavigationTiming?0<(n=O.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(O.g&&O.g.Ka&&O.g.Ka()&&O.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Dg=10;function Vl(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Dl(n){return n.h?1:n.g?n.g.size:0}function Wo(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Ho(n,e){n.g?n.g.add(e):n.h=e}function Nl(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function kl(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return Eo(n.i)}xl.prototype.cancel=function(){if(this.i=kl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var Ng=class{stringify(n){return O.JSON.stringify(n,void 0)}parse(n){return O.JSON.parse(n,void 0)}};function kg(){this.g=new Ng}function Mg(n,e,t){const r=t||"";try{Al(n,function(i,s){let o=i;mr(i)&&(o=Fo(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function zi(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function xr(n){this.l=n.ec||null,this.j=n.ob||!1}function ji(n,e){ye.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Yo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}_e(xr,Go),xr.prototype.g=function(){return new ji(this.l,this.j)},xr.prototype.i=function(n){return function(){return n}}({}),_e(ji,ye);var Yo=0;function Ml(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function Vr(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Dr(n)}function Dr(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(P=ji.prototype).open=function(n,e){if(this.readyState!=Yo)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Dr(this)},P.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||O).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},P.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Vr(this)),this.readyState=Yo},P.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Dr(this)),this.g&&(this.readyState=3,Dr(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof O.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ml(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},P.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Vr(this):Dr(this),3==this.readyState&&Ml(this)}},P.Za=function(n){this.g&&(this.response=this.responseText=n,Vr(this))},P.Ya=function(n){this.g&&(this.response=n,Vr(this))},P.ka=function(){this.g&&Vr(this)},P.setRequestHeader=function(n,e){this.v.append(n,e)},P.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},P.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(ji.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var Fg=O.JSON.parse;function ae(n){ye.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Ol,this.L=this.M=!1}_e(ae,ye);var Ol="",Lg=/^https?$/i,Bg=["POST","PUT"];function Fl(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Ll(n),$i(n)}function Ll(n){n.F||(n.F=!0,Ae(n,"complete"),Ae(n,"error"))}function Bl(n){if(n.h&&typeof yo<"u"&&(!n.C[1]||4!=tt(n)||2!=n.da()))if(n.v&&4==tt(n))Uo(n.La,0,n);else if(Ae(n,"readystatechange"),4==tt(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===o){var i=String(n.I).match(wl)[1]||null;!i&&O.self&&O.self.location&&(i=O.self.location.protocol.slice(0,-1)),r=!Lg.test(i?i.toLowerCase():"")}t=r}if(t)Ae(n,"complete"),Ae(n,"success");else{n.m=6;try{var s=2<tt(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Ll(n)}}finally{$i(n)}}}function $i(n,e){if(n.g){Ul(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Ae(n,"ready");try{t.onreadystatechange=r}catch{}}}function Ul(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(O.clearTimeout(n.A),n.A=null)}function tt(n){return n.g?n.g.readyState:0}function Gl(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Ol:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function ql(n){let e="";return bo(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function Jo(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=ql(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):ne(n,e,t))}function Nr(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function zl(n){this.Ga=0,this.j=[],this.l=new Mi,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Nr("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Nr("baseRetryDelayMs",5e3,n),this.hb=Nr("retryDelaySeedMs",1e4,n),this.eb=Nr("forwardChannelMaxRetries",2,n),this.xa=Nr("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new xl(n&&n.concurrentRequestLimit),this.Ja=new kg,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Xo(n){if(jl(n),3==n.H){var e=n.W++,t=ct(n.I);if(ne(t,"SID",n.K),ne(t,"RID",e),ne(t,"TYPE","terminate"),kr(n,t),(e=new wr(n,n.l,e)).L=2,e.A=qi(ct(t)),t=!1,O.navigator&&O.navigator.sendBeacon)try{t=O.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&O.Image&&((new Image).src=e.A,t=!0),t||(e.g=Zl(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Rr(e)}Jl(n)}function Ki(n){n.g&&(ea(n),n.g.cancel(),n.g=null)}function jl(n){Ki(n),n.u&&(O.clearTimeout(n.u),n.u=null),Wi(n),n.i.cancel(),n.m&&("number"==typeof n.m&&O.clearTimeout(n.m),n.m=null)}function Qi(n){if(!Vl(n.i)&&!n.m){n.m=!0;var e=n.Na;yr||sl(),Ir||(yr(),Ir=!0),Lo.add(e,n),n.C=0}}function $l(n,e){var t;t=e?e.m:n.W++;const r=ct(n.I);ne(r,"SID",n.K),ne(r,"RID",t),ne(r,"AID",n.V),kr(n,r),n.o&&n.s&&Jo(r,n.o,n.s),t=new wr(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=Kl(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Ho(n.i,t),Ko(t,r,e)}function kr(n,e){n.na&&bo(n.na,function(t,r){ne(e,r,t)}),n.h&&Al({},function(t,r){ne(e,r,t)})}function Kl(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Ce(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const o=["count="+t];-1==s?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let c=i[u].g;const l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{Mg(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function Ql(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;yr||sl(),Ir||(yr(),Ir=!0),Lo.add(e,n),n.A=0}}function Zo(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=vr(Ce(n.Ma,n),Yl(n,n.A)),n.A++,0))}function ea(n){null!=n.B&&(O.clearTimeout(n.B),n.B=null)}function Wl(n){n.g=new wr(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=ct(n.wa);ne(e,"RID","rpc"),ne(e,"SID",n.K),ne(e,"AID",n.V),ne(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&ne(e,"TO",n.qa),ne(e,"TYPE","xmlhttp"),kr(n,e),n.o&&n.s&&Jo(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=qi(ct(e)),t.u=null,t.S=!0,Il(t,n)}function Wi(n){null!=n.v&&(O.clearTimeout(n.v),n.v=null)}function Hl(n,e){var t=null;if(n.g==e){Wi(n),ea(n),n.g=null;var r=2}else{if(!Wo(n.i,e))return;t=e.F,Nl(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;Ae(r=Oi(),new fl(r,t)),Qi(n)}else Ql(n);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==r&&function qg(n,e){return!(Dl(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=vr(Ce(n.Na,n,e),Yl(n,n.C)),n.C++,0)))}(n,e)||2==r&&Zo(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Qt(n,5);break;case 4:Qt(n,10);break;case 3:Qt(n,6);break;default:Qt(n,2)}}function Yl(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Qt(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=Ce(n.pb,n);t||(t=new Kt("//www.google.com/images/cleardot.gif"),O.location&&"http"==O.location.protocol||Ui(t,"https"),qi(t)),function Og(n,e){const t=new Mi;if(O.Image){const r=new Image;r.onload=Ci(zi,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ci(zi,t,r,"TestLoadImage: error",!1,e),r.onabort=Ci(zi,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ci(zi,t,r,"TestLoadImage: timeout",!1,e),O.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else ke(2);n.H=0,n.h&&n.h.za(e),Jl(n),jl(n)}function Jl(n){if(n.H=0,n.ma=[],n.h){const e=kl(n.i);(0!=e.length||0!=n.j.length)&&($c(n.ma,e),$c(n.ma,n.j),n.i.i.length=0,Eo(n.j),n.j.length=0),n.h.ya()}}function Xl(n,e,t){var r=t instanceof Kt?ct(t):new Kt(t);if(""!=r.g)e&&(r.g=e+"."+r.g),Gi(r,r.m);else{var i=O.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Kt(null);r&&Ui(s,r),e&&(s.g=e),i&&Gi(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&ne(r,t,e),ne(r,"VER",n.ra),kr(n,r),r}function Zl(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new ae(n.Ha&&!n.va?new xr({ob:t}):n.va)).Oa(n.J),e}function eh(){}function Hi(){if(In&&!(10<=Number(tg)))throw Error("Environmental error: no available transport.")}function Ue(n,e){ye.call(this),this.g=new zl(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!pr(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!pr(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new vn(this)}function th(n){qo.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function nh(){zo.call(this),this.status=1}function vn(n){this.g=n}function Je(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function ta(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],o=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;o=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=t+((o=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function W(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(P=ae.prototype).Oa=function(n){this.M=n},P.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():jo.g(),this.C=function pl(n){return n.h||(n.h=n.i())}(this.u?this.u:jo),this.g.onreadystatechange=Ce(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void Fl(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=O.FormData&&n instanceof O.FormData,!(0<=jc(Bg,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Ul(this),0<this.B&&((this.L=function Ug(n){return In&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ce(this.ua,this)):this.A=Uo(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Fl(this,s)}},P.ua=function(){typeof yo<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ae(this,"timeout"),this.abort(8))},P.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Ae(this,"complete"),Ae(this,"abort"),$i(this))},P.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),$i(this,!0)),ae.$.N.call(this)},P.La=function(){this.s||(this.G||this.v||this.l?Bl(this):this.kb())},P.kb=function(){Bl(this)},P.isActive=function(){return!!this.g},P.da=function(){try{return 2<tt(this)?this.g.status:-1}catch{return-1}},P.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},P.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),Fg(e)}},P.Ia=function(){return this.m},P.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(P=zl.prototype).ra=8,P.H=1,P.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new wr(this,this.l,n);let s=this.s;if(this.U&&(s?(s=Yc(s),Xc(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Kl(this,i,e),ne(t=ct(this.I),"RID",n),ne(t,"CVER",22),this.F&&ne(t,"X-HTTP-Session-Id",this.F),kr(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(ql(s)))+"&"+e:this.o&&Jo(t,this.o,s)),Ho(this.i,i),this.bb&&ne(t,"TYPE","init"),this.P?(ne(t,"$req",e),ne(t,"SID","null"),i.aa=!0,Ko(i,t,null)):Ko(i,t,e),this.H=2}}else 3==this.H&&(n?$l(this,n):0==this.j.length||Vl(this.i)||$l(this))},P.Ma=function(){if(this.u=null,Wl(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=vr(Ce(this.jb,this),n)}},P.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ke(10),Ki(this),Wl(this))},P.ib=function(){null!=this.v&&(this.v=null,Ki(this),Zo(this),ke(19))},P.pb=function(n){n?(this.l.info("Successfully pinged google.com"),ke(2)):(this.l.info("Failed to ping google.com"),ke(1))},P.isActive=function(){return!!this.h&&this.h.isActive(this)},(P=eh.prototype).Ba=function(){},P.Aa=function(){},P.za=function(){},P.ya=function(){},P.isActive=function(){return!0},P.Va=function(){},Hi.prototype.g=function(n,e){return new Ue(n,e)},_e(Ue,ye),Ue.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;ke(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=Xl(n,null,n.Y),Qi(n)},Ue.prototype.close=function(){Xo(this.g)},Ue.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Fo(n),n=t);e.j.push(new Vg(e.fb++,n)),3==e.H&&Qi(e)},Ue.prototype.N=function(){this.g.h=null,delete this.j,Xo(this.g),delete this.g,Ue.$.N.call(this)},_e(th,qo),_e(nh,zo),_e(vn,eh),vn.prototype.Ba=function(){Ae(this.g,"a")},vn.prototype.Aa=function(n){Ae(this.g,new th(n))},vn.prototype.za=function(n){Ae(this.g,new nh)},vn.prototype.ya=function(){Ae(this.g,"b")},_e(Je,function zg(){this.blockSize=-1}),Je.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Je.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)ta(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){ta(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){ta(this,r),i=0;break}}this.h=i,this.i+=e},Je.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var jg={};function na(n){return-128<=n&&128>n?function Xp(n,e){var t=jg;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new W([0|e],0>e?-1:0)}):new W([0|n],0>n?-1:0)}function nt(n){if(isNaN(n)||!isFinite(n))return An;if(0>n)return we(nt(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=ra;return new W(e,0)}var ra=4294967296,An=na(0),ia=na(1),ih=na(16777216);function lt(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function Qe(n){return-1==n.h}function we(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new W(t,~n.h).add(ia)}function Yi(n,e){return n.add(we(e))}function Ji(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Mr(n,e){this.g=n,this.h=e}function Xi(n,e){if(lt(e))throw Error("division by zero");if(lt(n))return new Mr(An,An);if(Qe(n))return e=Xi(we(n),e),new Mr(we(e.g),we(e.h));if(Qe(e))return e=Xi(n,we(e)),new Mr(we(e.g),e.h);if(30<n.g.length){if(Qe(n)||Qe(e))throw Error("slowDivide_ only works with positive integers.");for(var t=ia,r=e;0>=r.X(n);)t=sh(t),r=sh(r);var i=wn(t,1),s=wn(r,1);for(r=wn(r,2),t=wn(t,2);!lt(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=wn(r,1),t=wn(t,1)}return e=Yi(n,i.R(e)),new Mr(i,e)}for(i=An;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),o=(s=nt(t)).R(e);Qe(o)||0<o.X(n);)o=(s=nt(t-=r)).R(e);lt(s)&&(s=ia),i=i.add(s),n=Yi(n,o)}return new Mr(i,n)}function sh(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new W(t,n.h)}function wn(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new W(i,n.h)}(P=W.prototype).ea=function(){if(Qe(this))return-we(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:ra+r)*e,e*=ra}return n},P.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(lt(this))return"0";if(Qe(this))return"-"+we(this).toString(n);for(var e=nt(Math.pow(n,6)),t=this,r="";;){var i=Xi(t,e).g,s=((0<(t=Yi(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(lt(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},P.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},P.X=function(n){return Qe(n=Yi(this,n))?-1:lt(n)?0:1},P.abs=function(){return Qe(this)?we(this):this},P.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,t[i]=(o&=65535)<<16|(s&=65535)}return new W(t,-2147483648&t[t.length-1]?-1:0)},P.R=function(n){if(lt(this)||lt(n))return An;if(Qe(this))return Qe(n)?we(this).R(we(n)):we(we(this).R(n));if(Qe(n))return we(this.R(we(n)));if(0>this.X(ih)&&0>n.X(ih))return nt(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=n.D(i)>>>16,u=65535&n.D(i);t[2*r+2*i]+=o*u,Ji(t,2*r+2*i),t[2*r+2*i+1]+=s*u,Ji(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,Ji(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,Ji(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new W(t,0)},P.gb=function(n){return Xi(this,n).h},P.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new W(t,this.h&n.h)},P.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new W(t,this.h|n.h)},P.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new W(t,this.h^n.h)},Hi.prototype.createWebChannel=Hi.prototype.g,Ue.prototype.send=Ue.prototype.u,Ue.prototype.open=Ue.prototype.m,Ue.prototype.close=Ue.prototype.close,Fi.NO_ERROR=0,Fi.TIMEOUT=8,Fi.HTTP_ERROR=6,ml.COMPLETE="complete",gl.EventType=Ar,Ar.OPEN="a",Ar.CLOSE="b",Ar.ERROR="c",Ar.MESSAGE="d",ye.prototype.listen=ye.prototype.O,ae.prototype.listenOnce=ae.prototype.P,ae.prototype.getLastError=ae.prototype.Sa,ae.prototype.getLastErrorCode=ae.prototype.Ia,ae.prototype.getStatus=ae.prototype.da,ae.prototype.getResponseJson=ae.prototype.Wa,ae.prototype.getResponseText=ae.prototype.ja,ae.prototype.send=ae.prototype.ha,ae.prototype.setWithCredentials=ae.prototype.Oa,Je.prototype.digest=Je.prototype.l,Je.prototype.reset=Je.prototype.reset,Je.prototype.update=Je.prototype.j,W.prototype.add=W.prototype.add,W.prototype.multiply=W.prototype.R,W.prototype.modulo=W.prototype.gb,W.prototype.compare=W.prototype.X,W.prototype.toNumber=W.prototype.ea,W.prototype.toString=W.prototype.toString,W.prototype.getBits=W.prototype.D,W.fromNumber=nt,W.fromString=function rh(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return we(rh(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=nt(Math.pow(e,8)),r=An,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=nt(Math.pow(e,s)),r=r.R(s).add(nt(o))):r=(r=r.R(t)).add(nt(o))}return r};var $g=Ye.createWebChannelTransport=function(){return new Hi},Kg=Ye.getStatEventTarget=function(){return Oi()},sa=Ye.ErrorCode=Fi,Qg=Ye.EventType=ml,Wg=Ye.Event=jt,oh=Ye.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Zi=(Ye.FetchXmlHttpFactory=xr,Ye.WebChannel=gl),Hg=Ye.XhrIo=ae,Yg=Ye.Md5=Je,Rn=Ye.Integer=W;const ah="@firebase/firestore";class Ie{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ie.UNAUTHENTICATED=new Ie(null),Ie.GOOGLE_CREDENTIALS=new Ie("google-credentials-uid"),Ie.FIRST_PARTY=new Ie("first-party-uid"),Ie.MOCK_USER=new Ie("mock-user");let Pn="10.8.0";const vt=new xc("@firebase/firestore");function Sn(){return vt.logLevel}function y(n,...e){if(vt.logLevel<=j.DEBUG){const t=e.map(oa);vt.debug(`Firestore (${Pn}): ${n}`,...t)}}function ce(n,...e){if(vt.logLevel<=j.ERROR){const t=e.map(oa);vt.error(`Firestore (${Pn}): ${n}`,...t)}}function Ge(n,...e){if(vt.logLevel<=j.WARN){const t=e.map(oa);vt.warn(`Firestore (${Pn}): ${n}`,...t)}}function oa(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function b(n="Unexpected state"){const e=`FIRESTORE (${Pn}) INTERNAL ASSERTION FAILED: `+n;throw ce(e),new Error(e)}function C(n,e){n||b()}function A(n,e){return n}const g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class I extends _n{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class me{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class uh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Jg{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ie.UNAUTHENTICATED))}shutdown(){}}class Xg{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Zg{constructor(e){this.t=e,this.currentUser=Ie.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let o=new me;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new me,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,_.c)(function*(){yield c.promise,yield s(r.currentUser)}))},u=c=>{y("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(y("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new me)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(y("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(C("string"==typeof r.accessToken),new uh(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return C(null===e||"string"==typeof e),new Ie(e)}}class e_{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Ie.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class t_{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new e_(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ie.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ch{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class n_{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&y("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,y("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{y("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):y("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(C("string"==typeof t.token),this.R=t.token,new ch(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function r_(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class lh{static newId(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=r_(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function M(n,e){return n<e?-1:n>e?1:0}function bn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}class oe{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new I(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new I(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new I(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new I(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return oe.fromMillis(Date.now())}static fromDate(e){return oe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new oe(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?M(this.nanoseconds,e.nanoseconds):M(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class x{constructor(e){this.timestamp=e}static fromTimestamp(e){return new x(e)}static min(){return new x(new oe(0,0))}static max(){return new x(new oe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Or{constructor(e,t,r){void 0===t?t=0:t>e.length&&b(),void 0===r?r=e.length-t:r>e.length-t&&b(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Or.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Or?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class G extends Or{construct(e,t,r){return new G(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new I(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new G(t)}static emptyPath(){return new G([])}}const i_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ie extends Or{construct(e,t,r){return new ie(e,t,r)}static isValidIdentifier(e){return i_.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ie.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ie(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new I(g.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if("\\"===a){if(i+1===e.length)throw new I(g.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new I(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else"`"===a?(o=!o,i++):"."!==a||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new I(g.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ie(t)}static emptyPath(){return new ie([])}}class R{constructor(e){this.path=e}static fromPath(e){return new R(G.fromString(e))}static fromName(e){return new R(G.fromString(e).popFirst(5))}static empty(){return new R(G.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===G.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return G.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new R(new G(e.slice()))}}function fh(n){return new qe(n.readTime,n.key,-1)}class qe{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new qe(x.min(),R.empty(),-1)}static max(){return new qe(x.max(),R.empty(),-1)}}function ua(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=R.comparator(n.documentKey,e.documentKey),0!==t?t:M(n.largestBatchId,e.largestBatchId))}const mh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ph{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function At(n){return ca.apply(this,arguments)}function ca(){return ca=(0,_.c)(function*(n){if(n.code!==g.FAILED_PRECONDITION||n.message!==mh)throw n;y("LocalStore","Unexpectedly lost primary lease")}),ca.apply(this,arguments)}class m{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&b(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new m((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof m?t:m.resolve(t)}catch(t){return m.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):m.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):m.reject(t)}static resolve(e){return new m((t,r)=>{t(e)})}static reject(e){return new m((t,r)=>{r(e)})}static waitFor(e){return new m((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=m.resolve(!1);for(const r of e)t=t.next(i=>i?m.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new m((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let u=0;u<s;u++){const c=u;t(e[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new m((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class es{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new me,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Fr(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=la(r.target.error);this.V.reject(new Fr(e,i))}}static open(e,t,r,i){try{return new es(t,e.transaction(i,r))}catch(s){throw new Fr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(y("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new u_(t)}}class We{constructor(e,t,r){this.name=e,this.version=t,this.p=r,12.2===We.S(V())&&ce("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return y("SimpleDb","Removing database:",e),Yt(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Rc())return!1;if(We.C())return!0;const e=V(),t=We.S(e),r=0<t&&t<10,i=We.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){var t=this;return(0,_.c)(function*(){return t.db||(y("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=o=>{r(o.target.result)},s.onblocked=()=>{i(new Fr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const a=o.target.error;i("VersionError"===a.name?new I(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new I(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new Fr(e,a))},s.onupgradeneeded=o=>{y("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.p.N(o.target.result,s.transaction,o.oldVersion,t.version).next(()=>{y("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=r=>t.B(r)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,_.c)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{s.db=yield s.O(e);const u=es.open(s.db,e,o?"readonly":"readwrite",r),c=i(u).next(l=>(u.g(),l)).catch(l=>(u.abort(l),m.reject(l))).toPromise();return c.catch(()=>{}),yield u.m,c}catch(u){const c=u,l="FirebaseError"!==c.name&&a<3;if(y("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),s.close(),!l)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class a_{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return Yt(this.k.delete())}}class Fr extends I{constructor(e,t){super(g.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function wt(n){return"IndexedDbTransactionError"===n.name}class u_{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(y("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(y("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Yt(r)}add(e){return y("SimpleDb","ADD",this.store.name,e,e),Yt(this.store.add(e))}get(e){return Yt(this.store.get(e)).next(t=>(void 0===t&&(t=null),y("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return y("SimpleDb","DELETE",this.store.name,e),Yt(this.store.delete(e))}count(){return y("SimpleDb","COUNT",this.store.name),Yt(this.store.count())}W(e,t){const r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(r.range);return new m((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{const s=this.cursor(r),o=[];return this.G(s,(a,u)=>{o.push(u)}).next(()=>o)}}j(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new m((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(e,t){y("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.J=!1;const i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.G(i,t)}Z(e){const t=this.cursor({});return new m((r,i)=>{t.onerror=s=>{const o=la(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(e,t){const r=[];return new m((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const u=new a_(a),c=t(a.primaryKey,a.value,u);if(c instanceof m){const l=c.catch(h=>(u.done(),m.reject(h)));r.push(l)}u.isDone?i():null===u.$?a.continue():a.continue(u.$)}}).next(()=>m.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Yt(n){return new m((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=la(r.target.error);t(i)}})}let gh=!1;function la(n){const e=We.S(V());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new I("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return gh||(gh=!0,setTimeout(()=>{throw r},0)),r}}return n}let ze=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}return n._e=-1,n})();function Lr(n){return null==n}function Br(n){return 0===n&&1/n==-1/0}function wh(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Rt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Rh(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class ee{constructor(e,t){this.comparator=e,this.root=t||Re.EMPTY}insert(e,t){return new ee(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Re.BLACK,null,null))}remove(e){return new ee(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Re.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ns(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ns(this.root,e,this.comparator,!1)}getReverseIterator(){return new ns(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ns(this.root,e,this.comparator,!0)}}class ns{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Re{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??Re.RED,this.left=i??Re.EMPTY,this.right=s??Re.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new Re(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Re.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Re.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Re.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Re.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw b();const e=this.left.check();if(e!==this.right.check())throw b();return e+(this.isRed()?0:1)}}Re.EMPTY=null,Re.RED=!0,Re.BLACK=!1,Re.EMPTY=new class{constructor(){this.size=0}get key(){throw b()}get value(){throw b()}get color(){throw b()}get left(){throw b()}get right(){throw b()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Re(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class J{constructor(e){this.comparator=e,this.data=new ee(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ph(this.data.getIterator())}getIteratorFrom(e){return new Ph(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof J)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new J(this.comparator);return t.data=e,t}}class Ph{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Fe{constructor(e){this.fields=e,e.sort(ie.comparator)}static empty(){return new Fe([])}unionWith(e){let t=new J(ie.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Fe(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return bn(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class Sh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class pe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Sh("Invalid base64 string: "+s):s}}(e);return new pe(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new pe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return M(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}pe.EMPTY_BYTE_STRING=new pe("");const C_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pt(n){if(C(!!n),"string"==typeof n){let e=0;const t=C_.exec(n);if(C(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ue(n.seconds),nanos:ue(n.nanos)}}function ue(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function ht(n){return"string"==typeof n?pe.fromBase64String(n):pe.fromUint8Array(n)}function rs(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function is(n){const e=n.mapValue.fields.__previous_value__;return rs(e)?is(e):e}function Ur(n){const e=Pt(n.mapValue.fields.__local_write_time__.timestampValue);return new oe(e.seconds,e.nanos)}class x_{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}}class Jt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Jt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Jt&&e.projectId===this.projectId&&e.database===this.database}}const St={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function bt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?rs(n)?4:Vh(n)?9007199254740991:10:b()}function it(n,e){if(n===e)return!0;const t=bt(n);if(t!==bt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ur(n).isEqual(Ur(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=Pt(i.timestampValue),a=Pt(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,ht(n.bytesValue).isEqual(ht(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ue(i.geoPointValue.latitude)===ue(s.geoPointValue.latitude)&&ue(i.geoPointValue.longitude)===ue(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ue(i.integerValue)===ue(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=ue(i.doubleValue),a=ue(s.doubleValue);return o===a?Br(o)===Br(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return bn(n.arrayValue.values||[],e.arrayValue.values||[],it);case 10:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(wh(o)!==wh(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(void 0===a[u]||!it(o[u],a[u])))return!1;return!0}(n,e);default:return b()}var s}function Gr(n,e){return void 0!==(n.values||[]).find(t=>it(t,e))}function Ct(n,e){if(n===e)return 0;const t=bt(n),r=bt(e);if(t!==r)return M(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return M(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=ue(s.integerValue||s.doubleValue),u=ue(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return bh(n.timestampValue,e.timestampValue);case 4:return bh(Ur(n),Ur(e));case 5:return M(n.stringValue,e.stringValue);case 6:return function(s,o){const a=ht(s),u=ht(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){const l=M(a[c],u[c]);if(0!==l)return l}return M(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=M(ue(s.latitude),ue(o.latitude));return 0!==a?a:M(ue(s.longitude),ue(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){const a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){const l=Ct(a[c],u[c]);if(l)return l}return M(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===St.mapValue&&o===St.mapValue)return 0;if(s===St.mapValue)return 1;if(o===St.mapValue)return-1;const a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){const f=M(u[h],l[h]);if(0!==f)return f;const p=Ct(a[u[h]],c[l[h]]);if(0!==p)return p}return M(u.length,l.length)}(n.mapValue,e.mapValue);default:throw b()}}function bh(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return M(n,e);const t=Pt(n),r=Pt(e),i=M(t.seconds,r.seconds);return 0!==i?i:M(t.nanos,r.nanos)}function Dn(n){return da(n)}function da(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Pt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?ht(n.bytesValue).toBase64():"referenceValue"in n?R.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=da(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${da(t.fields[o])}`;return i+"}"}(n.mapValue):b()}function fa(n){return!!n&&"integerValue"in n}function qr(n){return!!n&&"arrayValue"in n}function Ch(n){return!!n&&"nullValue"in n}function xh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function as(n){return!!n&&"mapValue"in n}function zr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Rt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=zr(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=zr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Vh(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}class Pe{constructor(e){this.value=e}static empty(){return new Pe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!as(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=zr(t)}setAll(e){let t=ie.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=zr(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());as(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return it(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];as(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Rt(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new Pe(zr(this.value))}}function kh(n){const e=[];return Rt(n.fields,(t,r)=>{const i=new ie([t]);if(as(r)){const s=kh(r.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Fe(e)}class re{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new re(e,0,x.min(),x.min(),x.min(),Pe.empty(),0)}static newFoundDocument(e,t,r,i){return new re(e,1,t,x.min(),r,i,0)}static newNoDocument(e,t){return new re(e,2,t,x.min(),x.min(),Pe.empty(),0)}static newUnknownDocument(e,t){return new re(e,3,t,x.min(),x.min(),Pe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(x.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=x.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof re&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new re(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class xt{constructor(e,t){this.position=e,this.inclusive=t}}function Mh(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(r=s.field.isKeyField()?R.comparator(R.fromName(o.referenceValue),t.key):Ct(o,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Oh(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!it(n.position[t],e.position[t]))return!1;return!0}class jr{constructor(e,t="asc"){this.field=e,this.dir=t}}function N_(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Fh{}class q extends Fh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new k_(e,t,r):"array-contains"===t?new F_(e,r):"in"===t?new zh(e,r):"not-in"===t?new L_(e,r):"array-contains-any"===t?new B_(e,r):new q(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new M_(e,r):new O_(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ct(t,this.value)):null!==t&&bt(this.value)===bt(t)&&this.matchesComparison(Ct(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return b()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class H extends Fh{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new H(e,t)}matches(e){return Nn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Nn(n){return"and"===n.op}function pa(n){return function Lh(n){for(const e of n.filters)if(e instanceof H)return!1;return!0}(n)&&Nn(n)}function ga(n){if(n instanceof q)return n.field.canonicalString()+n.op.toString()+Dn(n.value);if(pa(n))return n.filters.map(e=>ga(e)).join(",");{const e=n.filters.map(t=>ga(t)).join(",");return`${n.op}(${e})`}}function Bh(n,e){return n instanceof q?(r=n,(i=e)instanceof q&&r.op===i.op&&r.field.isEqual(i.field)&&it(r.value,i.value)):n instanceof H?function(r,i){return i instanceof H&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,o,a)=>s&&Bh(o,i.filters[a]),!0)}(n,e):void b();var r,i}function Gh(n){return n instanceof q?`${(t=n).field.canonicalString()} ${t.op} ${Dn(t.value)}`:n instanceof H?function(t){return t.op.toString()+" {"+t.getFilters().map(Gh).join(" ,")+"}"}(n):"Filter";var t}class k_ extends q{constructor(e,t,r){super(e,t,r),this.key=R.fromName(r.referenceValue)}matches(e){const t=R.comparator(e.key,this.key);return this.matchesComparison(t)}}class M_ extends q{constructor(e,t){super(e,"in",t),this.keys=qh(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class O_ extends q{constructor(e,t){super(e,"not-in",t),this.keys=qh(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function qh(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>R.fromName(r.referenceValue))}class F_ extends q{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return qr(t)&&Gr(t.arrayValue,this.value)}}class zh extends q{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Gr(this.value.arrayValue,t)}}class L_ extends q{constructor(e,t){super(e,"not-in",t)}matches(e){if(Gr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Gr(this.value.arrayValue,t)}}class B_ extends q{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!qr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Gr(this.value.arrayValue,r))}}class U_{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}}function _a(n,e=null,t=[],r=[],i=null,s=null,o=null){return new U_(n,e,t,r,i,s,o)}function Zt(n){const e=A(n);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>ga(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Lr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Dn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Dn(r)).join(",")),e.ce=t}return e.ce}function $r(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!N_(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Bh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Oh(n.startAt,e.startAt)&&Oh(n.endAt,e.endAt)}function us(n){return R.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}class dt{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.le=null,this.he=null,this.Pe=null}}function kn(n){return new dt(n)}function Qh(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function Mn(n){const e=A(n);if(null===e.le){e.le=[];const t=new Set;for(const s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new J(ie.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new jr(s,r))}),t.has(ie.keyField().canonicalString())||e.le.push(new jr(ie.keyField(),r))}return e.le}function Me(n){const e=A(n);return e.he||(e.he=function Wh(n,e){if("F"===n.limitType)return _a(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>new jr(i.field,"desc"===i.dir?"asc":"desc"));const t=n.endAt?new xt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new xt(n.startAt.position,n.startAt.inclusive):null;return _a(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}(e,Mn(n))),e.he}function ls(n,e,t){return new dt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Kr(n,e){return $r(Me(n),Me(e))&&n.limitType===e.limitType}function Hh(n){return`${Zt(Me(n))}|lt:${n.limitType}`}function On(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Gh(i)).join(", ")}]`),Lr(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Dn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Dn(i)).join(",")),`Target(${r})`}(Me(n))}; limitType=${n.limitType})`}function Qr(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):R.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of Mn(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(o,a,u){const c=Mh(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,Mn(r),i)||r.endAt&&!function(o,a,u){const c=Mh(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,Mn(r),i)));var r,i}function Jh(n){return(e,t)=>{let r=!1;for(const i of Mn(n)){const s=G_(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function G_(n,e,t){const r=n.field.isKeyField()?R.comparator(e.key,t.key):function(s,o,a){const u=o.data.field(s),c=a.data.field(s);return null!==u&&null!==c?Ct(u,c):b()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return b()}}class ft{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Rt(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Rh(this.inner)}size(){return this.innerSize}}const q_=new ee(R.comparator);function Le(){return q_}const Xh=new ee(R.comparator);function Wr(...n){let e=Xh;for(const t of n)e=e.insert(t.key,t);return e}function Zh(n){let e=Xh;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function st(){return Hr()}function ed(){return Hr()}function Hr(){return new ft(n=>n.toString(),(n,e)=>n.isEqual(e))}const z_=new ee(R.comparator),j_=new J(R.comparator);function B(...n){let e=j_;for(const t of n)e=e.add(t);return e}const $_=new J(M);function td(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Br(e)?"-0":e}}function nd(n){return{integerValue:""+n}}function rd(n,e){return function _h(n){return"number"==typeof n&&Number.isInteger(n)&&!Br(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}(e)?nd(e):td(n,e)}class hs{constructor(){this._=void 0}}function K_(n,e,t){return n instanceof Fn?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&rs(s)&&(s=is(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof en?sd(n,e):n instanceof tn?od(n,e):function(i,s){const o=id(i,s),a=ad(o)+ad(i.Ie);return fa(o)&&fa(i.Ie)?nd(a):td(i.serializer,a)}(n,e)}function Q_(n,e,t){return n instanceof en?sd(n,e):n instanceof tn?od(n,e):t}function id(n,e){return n instanceof Ln?fa(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class Fn extends hs{}class en extends hs{constructor(e){super(),this.elements=e}}function sd(n,e){const t=ud(e);for(const r of n.elements)t.some(i=>it(i,r))||t.push(r);return{arrayValue:{values:t}}}class tn extends hs{constructor(e){super(),this.elements=e}}function od(n,e){let t=ud(e);for(const r of n.elements)t=t.filter(i=>!it(i,r));return{arrayValue:{values:t}}}class Ln extends hs{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function ad(n){return ue(n.integerValue||n.doubleValue)}function ud(n){return qr(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class H_{constructor(e,t){this.version=e,this.transformResults=t}}class se{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new se}static exists(e){return new se(void 0,e)}static updateTime(e){return new se(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ds(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class fs{}function cd(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Un(n.key,se.none()):new Bn(n.key,n.data,se.none());{const t=n.data,r=Pe.empty();let i=new J(ie.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new mt(n.key,r,new Fe(i.toArray()),se.none())}}function Y_(n,e,t){n instanceof Bn?function(i,s,o){const a=i.value.clone(),u=dd(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof mt?function(i,s,o){if(!ds(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=dd(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(hd(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Jr(n,e,t,r){return n instanceof Bn?function(s,o,a,u){if(!ds(s.precondition,o))return a;const c=s.value.clone(),l=fd(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof mt?function(s,o,a,u){if(!ds(s.precondition,o))return a;const c=fd(s.fieldTransforms,u,o),l=o.data;return l.setAll(hd(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null===a?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):(a=t,ds(n.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a);var o,a}function J_(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=id(r.transform,i||null);null!=s&&(null===t&&(t=Pe.empty()),t.set(r.field,s))}return t||null}function ld(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&bn(r,i,(s,o)=>function W_(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof en&&i instanceof en||r instanceof tn&&i instanceof tn?bn(r.elements,i.elements,it):r instanceof Ln&&i instanceof Ln?it(r.Ie,i.Ie):r instanceof Fn&&i instanceof Fn);var r,i}(s,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class Bn extends fs{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class mt extends fs{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function hd(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function dd(n,e,t){const r=new Map;C(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,Q_(o,a,t[i]))}return r}function fd(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,K_(s,o,e))}return r}class Un extends fs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ta extends fs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class va{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Y_(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Jr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Jr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=ed();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const u=cd(o,a);null!==u&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(x.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),B())}isEqual(e){return this.batchId===e.batchId&&bn(this.mutations,e.mutations,(t,r)=>ld(t,r))&&bn(this.baseMutations,e.baseMutations,(t,r)=>ld(t,r))}}class Aa{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){C(e.mutations.length===r.length);let i=function(){return z_}();const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new Aa(e,t,r,i)}}class wa{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Z_{constructor(e,t){this.count=e,this.unchangedNames=t}}var fe,$;function pd(n){if(void 0===n)return ce("GRPC error has no .code"),g.UNKNOWN;switch(n){case fe.OK:return g.OK;case fe.CANCELLED:return g.CANCELLED;case fe.UNKNOWN:return g.UNKNOWN;case fe.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case fe.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case fe.INTERNAL:return g.INTERNAL;case fe.UNAVAILABLE:return g.UNAVAILABLE;case fe.UNAUTHENTICATED:return g.UNAUTHENTICATED;case fe.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case fe.NOT_FOUND:return g.NOT_FOUND;case fe.ALREADY_EXISTS:return g.ALREADY_EXISTS;case fe.PERMISSION_DENIED:return g.PERMISSION_DENIED;case fe.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case fe.ABORTED:return g.ABORTED;case fe.OUT_OF_RANGE:return g.OUT_OF_RANGE;case fe.UNIMPLEMENTED:return g.UNIMPLEMENTED;case fe.DATA_LOSS:return g.DATA_LOSS;default:return b()}}($=fe||(fe={}))[$.OK=0]="OK",$[$.CANCELLED=1]="CANCELLED",$[$.UNKNOWN=2]="UNKNOWN",$[$.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$[$.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$[$.NOT_FOUND=5]="NOT_FOUND",$[$.ALREADY_EXISTS=6]="ALREADY_EXISTS",$[$.PERMISSION_DENIED=7]="PERMISSION_DENIED",$[$.UNAUTHENTICATED=16]="UNAUTHENTICATED",$[$.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$[$.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$[$.ABORTED=10]="ABORTED",$[$.OUT_OF_RANGE=11]="OUT_OF_RANGE",$[$.UNIMPLEMENTED=12]="UNIMPLEMENTED",$[$.INTERNAL=13]="INTERNAL",$[$.UNAVAILABLE=14]="UNAVAILABLE",$[$.DATA_LOSS=15]="DATA_LOSS";const ey=new Rn([4294967295,4294967295],0);function _d(n){const e=function gd(){return new TextEncoder}().encode(n),t=new Yg;return t.update(e),new Uint8Array(t.digest())}function yd(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Rn([t,r],0),new Rn([i,s],0)]}class Ra{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Xr(`Invalid padding: ${t}`);if(r<0)throw new Xr(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new Xr(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new Xr(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=Rn.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(Rn.fromNumber(r)));return 1===i.compare(ey)&&(i=new Rn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=_d(e),[r,i]=yd(t);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new Ra(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(0===this.Te)return;const t=_d(e),[r,i]=yd(t);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);this.Re(o)}}Re(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Xr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Zr{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,ei.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Zr(x.min(),i,new ee(M),Le(),B())}}class ei{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new ei(r,t,B(),B(),B())}}class ps{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}}class Id{constructor(e,t){this.targetId=e,this.fe=t}}class Ed{constructor(e,t,r=pe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Td{constructor(){this.ge=0,this.pe=Ad(),this.ye=pe.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=B(),t=B(),r=B();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:b()}}),new ei(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=Ad()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,C(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class ty{constructor(e){this.Le=e,this.ke=new Map,this.qe=Le(),this.Qe=vd(),this.Ke=new ee(M)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{const r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Be(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:b()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){const t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){const s=i.target;if(us(s))if(0===r){const o=new R(s.path);this.We(t,o,re.newNoDocument(o,x.min()))}else C(1===r);else{const o=this.Ze(t);if(o!==r){const a=this.Xe(e),u=a?this.et(a,e,o):1;0!==u&&(this.He(t),this.Ke=this.Ke.insert(t,2===u?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,a;try{o=ht(r).toUint8Array()}catch(u){if(u instanceof Sh)return Ge("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Ra(o,i,s)}catch(u){return Ge(u instanceof Xr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return 0===a.Te?null:a}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(t,s,null),i++)}),i}it(e){const t=new Map;this.ke.forEach((s,o)=>{const a=this.Ye(o);if(a){if(s.current&&us(a.target)){const u=new R(a.target.path);null!==this.qe.get(u)||this.st(o,u)||this.We(o,u,re.newNoDocument(u,e))}s.De&&(t.set(o,s.ve()),s.Fe())}});let r=B();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Ye(u);return!c||"TargetPurposeLimboResolution"===c.purpose||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));const i=new Zr(e,t,this.Ke,this.qe,r);return this.qe=Le(),this.Qe=vd(),this.Ke=new ee(M),i}Ue(e,t){if(!this.je(e))return;const r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;const i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new Td,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new J(M),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||y("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new Td),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function vd(){return new ee(R.comparator)}function Ad(){return new ee(R.comparator)}const ny={asc:"ASCENDING",desc:"DESCENDING"},ry={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iy={and:"AND",or:"OR"};class sy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Pa(n,e){return n.useProto3Json||Lr(e)?e:{value:e}}function Gn(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function wd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function oy(n,e){return Gn(n,e.toTimestamp())}function le(n){return C(!!n),x.fromTimestamp(function(t){const r=Pt(t);return new oe(r.seconds,r.nanos)}(n))}function Sa(n,e){return ba(n,e).canonicalString()}function ba(n,e){const t=(i=n,new G(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function Rd(n){const e=G.fromString(n);return C(Md(e)),e}function ti(n,e){return Sa(n.databaseId,e.path)}function ot(n,e){const t=Rd(e);if(t.get(1)!==n.databaseId.projectId)throw new I(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new I(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new R(bd(t))}function Pd(n,e){return Sa(n.databaseId,e)}function Ca(n){return new G(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function bd(n){return C(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Cd(n,e,t){return{name:ti(n,e),fields:t.value.mapValue.fields}}function Vd(n,e){return{documents:[Pd(n,e.path)]}}function Va(n,e){const t={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Pd(n,i);const s=function(c){if(0!==c.length)return kd(H.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const o=function(c){if(0!==c.length)return c.map(l=>{return{field:Vt((f=l).field),direction:hy(f.dir)};var f})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Pa(n,e.limit);return null!==a&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt={before:(c=e.startAt).inclusive,values:c.position}),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ut:t,parent:i};var c}function Dd(n){let e=function Sd(n){const e=Rd(n);return 4===e.length?G.emptyPath():bd(e)}(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){C(1===r);const l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(h){const f=Nd(h);return f instanceof H&&pa(f)?f.getFilters():[f]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(f=>{return new jr(qn((E=f).field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction));var E}));let a=null;t.limit&&(a=function(h){let f;return f="object"==typeof h?h.value:h,Lr(f)?null:f}(t.limit));let u=null;var h;t.startAt&&(u=new xt((h=t.startAt).values||[],!!h.before));let c=null;return t.endAt&&(c=function(h){return new xt(h.values||[],!h.before)}(t.endAt)),function Kh(n,e,t,r,i,s,o,a){return new dt(n,e,t,r,i,s,o,a)}(e,i,o,s,a,"F",u,c)}function Nd(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=qn(t.unaryFilter.field);return q.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=qn(t.unaryFilter.field);return q.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=qn(t.unaryFilter.field);return q.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=qn(t.unaryFilter.field);return q.create(o,"!=",{nullValue:"NULL_VALUE"});default:return b()}}(n):void 0!==n.fieldFilter?q.create(qn((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return b()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return H.create(t.compositeFilter.filters.map(r=>Nd(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return b()}}(t.compositeFilter.op))}(n):b();var t}function hy(n){return ny[n]}function dy(n){return ry[n]}function fy(n){return iy[n]}function Vt(n){return{fieldPath:n.canonicalString()}}function qn(n){return ie.fromServerFormat(n.fieldPath)}function kd(n){return n instanceof q?function(t){if("=="===t.op){if(xh(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NAN"}};if(Ch(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(xh(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NOT_NAN"}};if(Ch(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Vt(t.field),op:dy(t.op),value:t.value}}}(n):n instanceof H?function(t){const r=t.getFilters().map(i=>kd(i));return 1===r.length?r[0]:{compositeFilter:{op:fy(t.op),filters:r}}}(n):b()}function my(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Md(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class pt{constructor(e,t,r,i,s=x.min(),o=x.min(),a=pe.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new pt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new pt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new pt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new pt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Od{constructor(e){this.ct=e}}function Da(n){const e=Dd({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?ls(e,e.limit,"L"):e}class on{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(ue(e.integerValue));else if("doubleValue"in e){const r=ue(e.doubleValue);isNaN(r)?this.Et(t,13):(this.Et(t,15),Br(r)?t.dt(0):t.dt(r))}else if("timestampValue"in e){const r=e.timestampValue;this.Et(t,20),"string"==typeof r?t.At(r):(t.At(`${r.seconds||""}`),t.dt(r.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(ht(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Et(t,45),t.dt(r.latitude||0),t.dt(r.longitude||0)}else"mapValue"in e?Vh(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):b()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const r=e.fields||{};this.Et(t,55);for(const i of Object.keys(r))this.Rt(i,t),this.It(r[i],t)}wt(e,t){const r=e.values||[];this.Et(t,50);for(const i of r)this.It(i,t)}gt(e,t){this.Et(t,37),R.fromName(e).path.forEach(r=>{this.Et(t,60),this.St(r,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}on.bt=new on;class vy{constructor(){this._n=new La}addToCollectionParentIndex(e,t){return this._n.add(t),m.resolve()}getCollectionParents(e,t){return m.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return m.resolve()}deleteFieldIndex(e,t){return m.resolve()}deleteAllFieldIndexes(e){return m.resolve()}createTargetIndexes(e,t){return m.resolve()}getDocumentsMatchingTarget(e,t){return m.resolve(null)}getIndexType(e,t){return m.resolve(0)}getFieldIndexes(e,t){return m.resolve([])}getNextCollectionGroupToUpdate(e){return m.resolve(null)}getMinOffset(e,t){return m.resolve(qe.min())}getMinOffsetFromCollectionGroup(e,t){return m.resolve(qe.min())}updateCollectionGroup(e,t,r){return m.resolve()}updateIndexEntries(e,t){return m.resolve()}}class La{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new J(G.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new J(G.comparator)).toArray()}}new Uint8Array(0);class De{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new De(e,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}De.DEFAULT_COLLECTION_PERCENTILE=10,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,De.DEFAULT=new De(41943040,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),De.DISABLED=new De(-1,0,0);class un{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new un(0)}static Bn(){return new un(-1)}}class of{constructor(){this.changes=new ft(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,re.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?m.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class xy{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class hf{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&Jr(r.mutation,i,Fe.empty(),oe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,B()).next(()=>r))}getLocalViewOfDocuments(e,t,r=B()){const i=st();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Wr();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=st();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,B()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Le();const o=Hr(),a=Hr();return t.forEach((u,c)=>{const l=r.get(c.key);i.has(c.key)&&(void 0===l||l.mutation instanceof mt)?s=s.insert(c.key,c):void 0!==l?(o.set(c.key,l.mutation.getFieldMask()),Jr(l.mutation,c,l.mutation.getFieldMask(),oe.now())):o.set(c.key,Fe.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new xy(l,null!==(h=o.get(c))&&void 0!==h?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Hr();let i=new ee((o,a)=>o-a),s=B();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(null===c)return;let l=r.get(u)||Fe.empty();l=a.applyToLocalView(c,l),r.set(u,l);const h=(i.get(a.batchId)||B()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,l=u.value,h=ed();l.forEach(f=>{if(!s.has(f)){const p=cd(t.get(f),r.get(f));null!==p&&h.set(f,p),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return R.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):function ya(n){return null!==n.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i);var o}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):m.resolve(st());let a=-1,u=s;return o.next(c=>m.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?m.resolve():this.remoteDocumentCache.getEntry(e,l).next(f=>{u=u.insert(l,f)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,B())).next(l=>({batchId:a,changes:Zh(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new R(t)).next(r=>{let i=Wr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=Wr();return this.indexManager.getCollectionParents(e,s).next(a=>m.forEach(a,u=>{const c=(h=t,f=u.child(s),new dt(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt));var h,f;return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(l=>{l.forEach((h,f)=>{o=o.insert(h,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{const l=c.getKey();null===o.get(l)&&(o=o.insert(l,re.newInvalidDocument(l)))});let a=Wr();return o.forEach((u,c)=>{const l=s.get(u);void 0!==l&&Jr(l.mutation,c,Fe.empty(),oe.now()),Qr(t,c)&&(a=a.insert(u,c))}),a})}}class Vy{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return m.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,{id:(i=t).id,version:i.version,createTime:le(i.createTime)}),m.resolve();var i}getNamedQuery(e,t){return m.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,{name:(i=t).name,query:Da(i.bundledQuery),readTime:le(i.readTime)}),m.resolve();var i}}class Dy{constructor(){this.overlays=new ee(R.comparator),this.hr=new Map}getOverlay(e,t){return m.resolve(this.overlays.get(t))}getOverlays(e,t){const r=st();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),m.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.hr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),m.resolve()}getOverlaysForCollection(e,t,r){const i=st(),s=t.length+1,o=new R(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return m.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ee((c,l)=>c-l);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=s.get(c.largestBatchId);null===l&&(l=st(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}const a=st(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return m.resolve(a)}ht(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new wa(t,r));let s=this.hr.get(t);void 0===s&&(s=B(),this.hr.set(t,s)),this.hr.set(t,s.add(r.key))}}class Ba{constructor(){this.Pr=new J(Te.Ir),this.Tr=new J(Te.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const r=new Te(e,t);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Ar(new Te(e,t))}Rr(e,t){e.forEach(r=>this.removeReference(r,t))}Vr(e){const t=new R(new G([])),r=new Te(t,e),i=new Te(t,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new R(new G([])),r=new Te(t,e),i=new Te(t,e+1);let s=B();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new Te(e,0),r=this.Pr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class Te{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return R.comparator(e.key,t.key)||M(e.pr,t.pr)}static Er(e,t){return M(e.pr,t.pr)||R.comparator(e.key,t.key)}}class Ny{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new J(Te.Ir)}checkEmpty(e){return m.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.yr;this.yr++;const o=new va(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.wr=this.wr.add(new Te(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(e,t){return m.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.br(t+1),s=i<0?0:i;return m.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Te(t,0),i=new Te(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{const a=this.Sr(o.pr);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new J(M);return t.forEach(i=>{const s=new Te(i,0),o=new Te(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),m.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;R.isDocumentKey(s)||(s=s.child(""));const o=new Te(new R(s),0);let a=new J(M);return this.wr.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.pr)),!0)},o),m.resolve(this.Dr(a))}Dr(e){const t=[];return e.forEach(r=>{const i=this.Sr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){C(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let r=this.wr;return m.forEach(t.mutations,i=>{const s=new Te(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,t){const r=new Te(t,0),i=this.wr.firstAfterOrEqual(r);return m.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return m.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ky{constructor(e){this.vr=e,this.docs=new ee(R.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return m.resolve(r?r.document.mutableCopy():re.newInvalidDocument(t))}getEntries(e,t){let r=Le();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():re.newInvalidDocument(i))}),m.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Le();const o=t.path,a=new R(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||ua(fh(l),r)<=0||(i.has(l.key)||Qr(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return m.resolve(s)}getAllFromCollectionGroup(e,t,r,i){b()}Fr(e,t){return m.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new My(this)}getSize(e){return m.resolve(this.size)}}class My extends of{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),m.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Oy{constructor(e){this.persistence=e,this.Mr=new ft(t=>Zt(t),$r),this.lastRemoteSnapshotVersion=x.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Ba,this.targetCount=0,this.Br=un.Nn()}forEachTarget(e,t){return this.Mr.forEach((r,i)=>t(i)),m.resolve()}getLastRemoteSnapshotVersion(e){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return m.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Or&&(this.Or=t),m.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Br=new un(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,m.resolve()}updateTargetData(e,t){return this.qn(t),m.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,m.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),m.waitFor(s).next(()=>i)}getTargetCount(e){return m.resolve(this.targetCount)}getTargetData(e,t){const r=this.Mr.get(t)||null;return m.resolve(r)}addMatchingKeys(e,t,r){return this.Nr.dr(t,r),m.resolve()}removeMatchingKeys(e,t,r){this.Nr.Rr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),m.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Nr.gr(t);return m.resolve(r)}containsKey(e,t){return m.resolve(this.Nr.containsKey(t))}}class Ua{constructor(e,t){this.Lr={},this.overlays={},this.kr=new ze(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Oy(this),this.indexManager=new vy,this.remoteDocumentCache=new ky(r=>this.referenceDelegate.Kr(r)),this.serializer=new Od(t),this.$r=new Vy(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Dy,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Lr[e.toKey()];return r||(r=new Ny(t,this.referenceDelegate),this.Lr[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,r){y("MemoryPersistence","Starting transaction:",e);const i=new Fy(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return m.or(Object.values(this.Lr).map(r=>()=>r.containsKey(e,t)))}}class Fy extends ph{constructor(e){super(),this.currentSequenceNumber=e}}class As{constructor(e){this.persistence=e,this.zr=new Ba,this.jr=null}static Hr(e){return new As(e)}get Jr(){if(this.jr)return this.jr;throw b()}addReference(e,t,r){return this.zr.addReference(r,t),this.Jr.delete(r.toString()),m.resolve()}removeReference(e,t,r){return this.zr.removeReference(r,t),this.Jr.add(r.toString()),m.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),m.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.Jr,r=>{const i=R.fromPath(r);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,x.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(r=>{r?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return m.or([()=>m.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class ja{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.qi=r,this.Qi=i}static Ki(e,t){let r=B(),i=B();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new ja(e,t.fromCache,r,i)}}class By{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ff{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function wc(){return!function S(){var n;const e=null===(n=pn())||void 0===n?void 0:n.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch{return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}()?8:We.v(V())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.ji(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new By;return this.Ji(e,t,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(e,t,o,a.size)})}).next(()=>s.result)}Yi(e,t,r,i){return r.documentReadCount<this.Wi?(Sn()<=j.DEBUG&&y("QueryEngine","SDK will not create cache indexes for query:",On(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),m.resolve()):(Sn()<=j.DEBUG&&y("QueryEngine","Query:",On(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(Sn()<=j.DEBUG&&y("QueryEngine","The SDK decides to create cache indexes for query:",On(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Me(t))):m.resolve())}ji(e,t){if(Qh(t))return m.resolve(null);let r=Me(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=ls(t,null,"F"),r=Me(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=B(...s);return this.zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const c=this.Zi(t,a);return this.Xi(t,c,o,u.readTime)?this.ji(e,ls(t,null,"F")):this.es(e,c,t,u)}))})))}Hi(e,t,r,i){return Qh(t)||i.isEqual(x.min())?m.resolve(null):this.zi.getDocuments(e,r).next(s=>{const o=this.Zi(t,s);return this.Xi(t,o,r,i)?m.resolve(null):(Sn()<=j.DEBUG&&y("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),On(t)),this.es(e,o,t,function dh(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=x.fromTimestamp(1e9===r?new oe(t+1,0):new oe(t,r));return new qe(i,R.empty(),e)}(i,-1)).next(a=>a))})}Zi(e,t){let r=new J(Jh(e));return t.forEach((i,s)=>{Qr(e,s)&&(r=r.add(s))}),r}Xi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,r){return Sn()<=j.DEBUG&&y("QueryEngine","Using full collection scan to execute query:",On(t)),this.zi.getDocumentsMatchingQuery(e,t,qe.min(),r)}es(e,t,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class Uy{constructor(e,t,r,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new ee(M),this.rs=new ft(s=>Zt(s),$r),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new hf(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}}function pf(n,e){return $a.apply(this,arguments)}function $a(){return $a=(0,_.c)(function*(n,e){const t=A(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let u=B();for(const c of i){o.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}for(const c of s){a.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({us:c,removedBatchIds:o,addedBatchIds:a}))})})}),$a.apply(this,arguments)}function gf(n){const e=A(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function zy(n,e){const t=A(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Wn(n,e,t){return Ka.apply(this,arguments)}function Ka(){return Ka=(0,_.c)(function*(n,e,t){const r=A(n),i=r.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!wt(o))throw o;y("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)}),Ka.apply(this,arguments)}function Ps(n,e,t){const r=A(n);let i=x.min(),s=B();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){const h=A(u),f=h.rs.get(l);return void 0!==f?m.resolve(h.ns.get(f)):h.Qr.getTargetData(c,l)}(r,o,Me(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.ts.getDocumentsMatchingQuery(o,e,t?i:x.min(),t?s:B())).next(a=>(function Ef(n,e,t){let r=n.ss.get(e)||x.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.ss.set(e,r)}(r,function Yh(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}(e),a),{documents:a,hs:s})))}class Ja{constructor(){this.activeTargetIds=function Ea(){return $_}()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Af{constructor(){this.no=new Ja,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,r){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Ja,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Ky{io(e){}shutdown(){}}class wf{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){y("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){y("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Cs=null;function Za(){return null===Cs?Cs=268435456+Math.round(2147483648*Math.random()):Cs++,"0x"+Cs.toString(16)}const Qy={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Wy{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}const Ne="WebChannelConnection";class Hy extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+t.host,this.po=`projects/${i}/databases/${s}`,this.yo="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(t,r,i,s,o){const a=Za(),u=this.bo(t,r.toUriEncodedString());y("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);const c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,s,o),this.Co(t,u,c,i).then(l=>(y("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw Ge("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}vo(t,r,i,s,o,a){return this.So(t,r,i,s,o)}Do(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Pn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}bo(t,r){return`${this.fo}/v1/${r}:${Qy[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,r,i){const s=Za();return new Promise((o,a)=>{const u=new Hg;u.setWithCredentials(!0),u.listenOnce(Qg.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case sa.NO_ERROR:const l=u.getResponseJson();y(Ne,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case sa.TIMEOUT:y(Ne,`RPC '${e}' ${s} timed out`),a(new I(g.DEADLINE_EXCEEDED,"Request time out"));break;case sa.HTTP_ERROR:const h=u.getStatus();if(y(Ne,`RPC '${e}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let f=u.getResponseJson();Array.isArray(f)&&(f=f[0]);const p=f?.error;if(p&&p.status&&p.message){const E=function(v){const D=v.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(D)>=0?D:g.UNKNOWN}(p.status);a(new I(E,p.message))}else a(new I(g.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new I(g.UNAVAILABLE,"Connection failed."));break;default:b()}}finally{y(Ne,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(i);y(Ne,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}Fo(e,t,r){const i=Za(),s=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=$g(),a=Kg(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const l=s.join("");y(Ne,`Creating RPC '${e}' stream ${i}: ${l}`,u);const h=o.createWebChannel(l,u);let f=!1,p=!1;const E=new Wy({lo:v=>{p?y(Ne,`Not sending because RPC '${e}' stream ${i} is closed:`,v):(f||(y(Ne,`Opening RPC '${e}' stream ${i} transport.`),h.open(),f=!0),y(Ne,`RPC '${e}' stream ${i} sending:`,v),h.send(v))},ho:()=>h.close()}),w=(v,D,F)=>{v.listen(D,N=>{try{F(N)}catch(U){setTimeout(()=>{throw U},0)}})};return w(h,Zi.EventType.OPEN,()=>{p||y(Ne,`RPC '${e}' stream ${i} transport opened.`)}),w(h,Zi.EventType.CLOSE,()=>{p||(p=!0,y(Ne,`RPC '${e}' stream ${i} transport closed`),E.Vo())}),w(h,Zi.EventType.ERROR,v=>{p||(p=!0,Ge(Ne,`RPC '${e}' stream ${i} transport errored:`,v),E.Vo(new I(g.UNAVAILABLE,"The operation could not be completed")))}),w(h,Zi.EventType.MESSAGE,v=>{var D;if(!p){const F=v.data[0];C(!!F);const U=F.error||(null===(D=F[0])||void 0===D?void 0:D.error);if(U){y(Ne,`RPC '${e}' stream ${i} received error:`,U);const Z=U.status;let Y=function(NE){const Rm=fe[NE];if(void 0!==Rm)return pd(Rm)}(Z),ge=U.message;void 0===Y&&(Y=g.INTERNAL,ge="Unknown error status: "+Z+" with message "+U.message),p=!0,E.Vo(new I(Y,ge)),h.close()}else y(Ne,`RPC '${e}' stream ${i} received:`,F),E.mo(F)}}),w(a,Wg.STAT_EVENT,v=>{v.stat===oh.PROXY?y(Ne,`RPC '${e}' stream ${i} detected buffering proxy`):v.stat===oh.NOPROXY&&y(Ne,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{E.Ro()},0),E}}function xs(){return typeof document<"u"?document:null}function li(n){return new sy(n,!0)}class eu{constructor(e,t,r=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const t=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Lo),i=Math.max(0,t-r);i>0&&y("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Lo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class Pf{constructor(e,t,r,i,s,o,a,u){this.oi=e,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new eu(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}stop(){var e=this;return(0,_.c)(function*(){e.Ho()&&(yield e.close(0))})()}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}e_(){var e=this;return(0,_.c)(function*(){if(e.Jo())return e.close(0)})()}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(e,t){var r=this;return(0,_.c)(function*(){r.n_(),r.r_(),r.jo.cancel(),r.Wo++,4!==e?r.jo.reset():t&&t.code===g.RESOURCE_EXHAUSTED?(ce(t.toString()),ce("Using maximum backoff delay to prevent overloading the backend."),r.jo.ko()):t&&t.code===g.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.i_(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.To(t)})()}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===t&&this.o_(r,i)},r=>{e(()=>{const i=new I(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(e,t){const r=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){var e=this;this.state=5,this.jo.qo((0,_.c)(function*(){e.state=0,e.start()}))}__(e){return y("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget(()=>this.Wo===e?t():(y("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Yy extends Pf{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();const t=function uy(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(c=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===c?1:"REMOVE"===c?2:"CURRENT"===c?3:"RESET"===c?4:b(),i=e.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(C(void 0===l||"string"==typeof l),pe.fromBase64String(l||"")):(C(void 0===l||l instanceof Uint8Array),pe.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const l=void 0===c.code?g.UNKNOWN:pd(c.code);return new I(l,c.message||"")}(o);t=new Ed(r,i,s,a||null)}else if("documentChange"in e){const r=e.documentChange,i=ot(n,r.document.name),s=le(r.document.updateTime),o=r.document.createTime?le(r.document.createTime):x.min(),a=new Pe({mapValue:{fields:r.document.fields}}),u=re.newFoundDocument(i,s,o,a);t=new ps(r.targetIds||[],r.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const r=e.documentDelete,i=ot(n,r.document),s=r.readTime?le(r.readTime):x.min(),o=re.newNoDocument(i,s);t=new ps([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,i=ot(n,r.document);t=new ps([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return b();{const r=e.filter,{count:i=0,unchangedNames:s}=r,o=new Z_(i,s);t=new Id(r.targetId,o)}}var c;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return x.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?x.min():o.readTime?le(o.readTime):x.min()}(e);return this.listener.u_(t,r)}c_(e){const t={};t.database=Ca(this.serializer),t.addTarget=function(s,o){let a;const u=o.target;if(a=us(u)?{documents:Vd(s,u)}:{query:Va(s,u).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=wd(s,o.resumeToken);const c=Pa(s,o.expectedCount);null!==c&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(x.min())>0){a.readTime=Gn(s,o.snapshotVersion.toTimestamp());const c=Pa(s,o.expectedCount);null!==c&&(a.expectedCount=c)}return a}(this.serializer,e);const r=function ly(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return b()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.t_(t)}l_(e){const t={};t.database=Ca(this.serializer),t.removeTarget=e,this.t_(t)}}class Jy extends Pf{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(C(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const t=function cy(n,e){return n&&n.length>0?(C(void 0!==e),n.map(t=>function(i,s){let o=le(i.updateTime?i.updateTime:s);return o.isEqual(x.min())&&(o=le(s)),new H_(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=le(e.commitTime);return this.listener.T_(r,t)}return C(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=Ca(this.serializer),this.t_(e)}I_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>function ni(n,e){let t;if(e instanceof Bn)t={update:Cd(n,e.key,e.value)};else if(e instanceof Un)t={delete:ti(n,e.key)};else if(e instanceof mt)t={update:Cd(n,e.key,e.data),updateMask:my(e.fieldMask)};else{if(!(e instanceof Ta))return b();t={verify:ti(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof Fn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof en)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof tn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Ln)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw b()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:oy(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:b()),t;var s}(this.serializer,r))};this.t_(t)}}class Xy extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new I(g.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(e,ba(t,r),i,s,o)).catch(s=>{throw"FirebaseError"===s.name?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new I(g.UNKNOWN,s.toString())})}vo(e,t,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(e,ba(t,r),i,o,a,s)).catch(o=>{throw"FirebaseError"===o.name?(o.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new I(g.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}}class eI{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(ce(t),this.g_=!1):y("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class tI{constructor(e,t,r,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(a=>{r.enqueueAndForget((0,_.c)(function*(){var u;Mt(o)&&(y("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,_.c)(function*(l){const h=A(l);h.v_.add(4),yield Hn(h),h.x_.set("Unknown"),h.v_.delete(4),yield hi(h)}),function c(l){return u.apply(this,arguments)})(o))}))}),this.x_=new eI(r,i)}}function hi(n){return nu.apply(this,arguments)}function nu(){return nu=(0,_.c)(function*(n){if(Mt(n))for(const e of n.F_)yield e(!0)}),nu.apply(this,arguments)}function Hn(n){return ru.apply(this,arguments)}function ru(){return ru=(0,_.c)(function*(n){for(const e of n.F_)yield e(!1)}),ru.apply(this,arguments)}function Vs(n,e){const t=A(n);t.C_.has(e.targetId)||(t.C_.set(e.targetId,e),ou(t)?su(t):Jn(t).Jo()&&iu(t,e))}function di(n,e){const t=A(n),r=Jn(t);t.C_.delete(e),r.Jo()&&Sf(t,e),0===t.C_.size&&(r.Jo()?r.Xo():Mt(t)&&t.x_.set("Unknown"))}function iu(n,e){if(n.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(x.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Jn(n).c_(e)}function Sf(n,e){n.O_.Oe(e),Jn(n).l_(e)}function su(n){n.O_=new ty({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.C_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),Jn(n).start(),n.x_.p_()}function ou(n){return Mt(n)&&!Jn(n).Ho()&&n.C_.size>0}function Mt(n){return 0===A(n).v_.size}function bf(n){n.O_=void 0}function nI(n){return au.apply(this,arguments)}function au(){return au=(0,_.c)(function*(n){n.C_.forEach((e,t)=>{iu(n,e)})}),au.apply(this,arguments)}function rI(n,e){return uu.apply(this,arguments)}function uu(){return uu=(0,_.c)(function*(n,e){bf(n),ou(n)?(n.x_.S_(e),su(n)):n.x_.set("Unknown")}),uu.apply(this,arguments)}function iI(n,e,t){return cu.apply(this,arguments)}function cu(){return cu=(0,_.c)(function*(n,e,t){if(n.x_.set("Online"),e instanceof Ed&&2===e.state&&e.cause)try{yield(r=(0,_.c)(function*(s,o){const a=o.cause;for(const u of o.targetIds)s.C_.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.C_.delete(u),s.O_.removeTarget(u))}),function i(s,o){return r.apply(this,arguments)})(n,e)}catch(r){y("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ds(n,r)}else if(e instanceof ps?n.O_.$e(e):e instanceof Id?n.O_.Je(e):n.O_.Ge(e),!t.isEqual(x.min()))try{const r=yield gf(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){const a=s.O_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){const l=s.C_.get(c);l&&s.C_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{const l=s.C_.get(u);if(!l)return;s.C_.set(u,l.withResumeToken(pe.EMPTY_BYTE_STRING,l.snapshotVersion)),Sf(s,u);const h=new pt(l.target,u,c,l.sequenceNumber);iu(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){y("RemoteStore","Failed to raise snapshot:",r),yield Ds(n,r)}var r}),cu.apply(this,arguments)}function Ds(n,e,t){return lu.apply(this,arguments)}function lu(){return lu=(0,_.c)(function*(n,e,t){if(!wt(e))throw e;n.v_.add(1),yield Hn(n),n.x_.set("Offline"),t||(t=()=>gf(n.localStore)),n.asyncQueue.enqueueRetryable((0,_.c)(function*(){y("RemoteStore","Retrying IndexedDB access"),yield t(),n.v_.delete(1),yield hi(n)}))}),lu.apply(this,arguments)}function Cf(n,e){return e().catch(t=>Ds(n,t,e))}function Yn(n){return hu.apply(this,arguments)}function hu(){return hu=(0,_.c)(function*(n){const e=A(n),t=Ot(e);let r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;sI(e);)try{const i=yield zy(e.localStore,r);if(null===i){0===e.D_.length&&t.Xo();break}r=i.batchId,oI(e,i)}catch(i){yield Ds(e,i)}xf(e)&&Vf(e)}),hu.apply(this,arguments)}function sI(n){return Mt(n)&&n.D_.length<10}function oI(n,e){n.D_.push(e);const t=Ot(n);t.Jo()&&t.P_&&t.I_(e.mutations)}function xf(n){return Mt(n)&&!Ot(n).Ho()&&n.D_.length>0}function Vf(n){Ot(n).start()}function aI(n){return du.apply(this,arguments)}function du(){return du=(0,_.c)(function*(n){Ot(n).d_()}),du.apply(this,arguments)}function uI(n){return fu.apply(this,arguments)}function fu(){return fu=(0,_.c)(function*(n){const e=Ot(n);for(const t of n.D_)e.I_(t.mutations)}),fu.apply(this,arguments)}function cI(n,e,t){return mu.apply(this,arguments)}function mu(){return mu=(0,_.c)(function*(n,e,t){const r=n.D_.shift(),i=Aa.from(r,e,t);yield Cf(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Yn(n)}),mu.apply(this,arguments)}function lI(n,e){return pu.apply(this,arguments)}function pu(){return pu=(0,_.c)(function*(n,e){var t;e&&Ot(n).P_&&(yield(t=(0,_.c)(function*(i,s){if(function md(n){switch(n){default:return b();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}(a=s.code)&&a!==g.ABORTED){const o=i.D_.shift();Ot(i).Zo(),yield Cf(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield Yn(i)}var a}),function r(i,s){return t.apply(this,arguments)})(n,e)),xf(n)&&Vf(n)}),pu.apply(this,arguments)}function Df(n,e){return gu.apply(this,arguments)}function gu(){return gu=(0,_.c)(function*(n,e){const t=A(n);t.asyncQueue.verifyOperationInProgress(),y("RemoteStore","RemoteStore received new credentials");const r=Mt(t);t.v_.add(3),yield Hn(t),r&&t.x_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.v_.delete(3),yield hi(t)}),gu.apply(this,arguments)}function yu(){return yu=(0,_.c)(function*(n,e){const t=A(n);e?(t.v_.delete(2),yield hi(t)):e||(t.v_.add(2),yield Hn(t),t.x_.set("Unknown"))}),yu.apply(this,arguments)}function Jn(n){return n.N_||(n.N_=function(t,r,i){const s=A(t);return s.R_(),new Yy(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:nI.bind(null,n),To:rI.bind(null,n),u_:iI.bind(null,n)}),n.F_.push(function(){var e=(0,_.c)(function*(t){t?(n.N_.Zo(),ou(n)?su(n):n.x_.set("Unknown")):(yield n.N_.stop(),bf(n))});return function(t){return e.apply(this,arguments)}}())),n.N_}function Ot(n){return n.B_||(n.B_=function(t,r,i){const s=A(t);return s.R_(),new Jy(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:aI.bind(null,n),To:lI.bind(null,n),E_:uI.bind(null,n),T_:cI.bind(null,n)}),n.F_.push(function(){var e=(0,_.c)(function*(t){t?(n.B_.Zo(),yield Yn(n)):(yield n.B_.stop(),n.D_.length>0&&(y("RemoteStore",`Stopping write stream with ${n.D_.length} pending writes`),n.D_=[]))});return function(t){return e.apply(this,arguments)}}())),n.B_}class Iu{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new me,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new Iu(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new I(g.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Xn(n,e){if(ce("AsyncQueue",`${e}: ${n}`),wt(n))return new I(g.UNAVAILABLE,`${e}: ${n}`);throw n}class Zn{constructor(e){this.comparator=e?(t,r)=>e(t,r)||R.comparator(t.key,r.key):(t,r)=>R.comparator(t.key,r.key),this.keyedMap=Wr(),this.sortedSet=new ee(this.comparator)}static emptySet(e){return new Zn(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Zn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Zn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Nf{constructor(){this.L_=new ee(R.comparator)}track(e){const t=e.doc.key,r=this.L_.get(t);r?0!==e.type&&3===r.type?this.L_=this.L_.insert(t,e):3===e.type&&1!==r.type?this.L_=this.L_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.L_=this.L_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.L_=this.L_.remove(t):1===e.type&&2===r.type?this.L_=this.L_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):b():this.L_=this.L_.insert(t,e)}k_(){const e=[];return this.L_.inorderTraversal((t,r)=>{e.push(r)}),e}}class er{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new er(e,t,Zn.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Kr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class hI{constructor(){this.q_=void 0,this.Q_=[]}}class dI{constructor(){this.queries=new ft(e=>Hh(e),Kr),this.onlineState="Unknown",this.K_=new Set}}function Eu(n,e){return Tu.apply(this,arguments)}function Tu(){return Tu=(0,_.c)(function*(n,e){const t=A(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new hI),i)try{s.q_=yield t.onListen(r)}catch(o){const a=Xn(o,`Initialization of query '${On(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.Q_.push(e),e.U_(t.onlineState),s.q_&&e.W_(s.q_)&&wu(t)}),Tu.apply(this,arguments)}function vu(n,e){return Au.apply(this,arguments)}function Au(){return Au=(0,_.c)(function*(n,e){const t=A(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const o=s.Q_.indexOf(e);o>=0&&(s.Q_.splice(o,1),i=0===s.Q_.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),Au.apply(this,arguments)}function fI(n,e){const t=A(n);let r=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const a of o.Q_)a.W_(i)&&(r=!0);o.q_=i}}r&&wu(t)}function mI(n,e,t){const r=A(n),i=r.queries.get(e);if(i)for(const s of i.Q_)s.onError(t);r.queries.delete(e)}function wu(n){n.K_.forEach(e=>{e.next()})}class Ru{constructor(e,t,r){this.query=e,this.G_=t,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=r||{}}W_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new er(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.z_?this.H_(e)&&(this.G_.next(e),t=!0):this.J_(e,this.onlineState)&&(this.Y_(e),t=!0),this.j_=e,t}onError(e){this.G_.error(e)}U_(e){this.onlineState=e;let t=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),t=!0),t}J_(e,t){return!e.fromCache||(!this.options.Z_||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}H_(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Y_(e){e=er.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}}class Of{constructor(e){this.key=e}}class Ff{constructor(e){this.key=e}}class Lf{constructor(e,t){this.query=e,this.oa=t,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=B(),this.mutatedKeys=B(),this.ua=Jh(e),this.ca=new Zn(this.ua)}get la(){return this.oa}ha(e,t){const r=t?t.Pa:new Nf,i=t?t.ca:this.ca;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const u="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{const f=i.get(l),p=Qr(this.query,h)?h:null,E=!!f&&this.mutatedKeys.has(f.key),w=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let v=!1;f&&p?f.data.isEqual(p.data)?E!==w&&(r.track({type:3,doc:p}),v=!0):this.Ia(f,p)||(r.track({type:2,doc:p}),v=!0,(u&&this.ua(p,u)>0||c&&this.ua(p,c)<0)&&(a=!0)):!f&&p?(r.track({type:0,doc:p}),v=!0):f&&!p&&(r.track({type:1,doc:f}),v=!0,(u||c)&&(a=!0)),v&&(p?(o=o.add(p),s=w?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{ca:o,Pa:r,Xi:a,mutatedKeys:s}}Ia(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;const o=e.Pa.k_();o.sort((l,h)=>function(p,E){const w=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return b()}};return w(p)-w(E)}(l.type,h.type)||this.ua(l.doc,h.doc)),this.Ta(r),i=null!=i&&i;const a=t&&!i?this.Ea():[],u=0===this.aa.size&&this.current&&!i?1:0,c=u!==this._a;return this._a=u,0!==o.length||c?{snapshot:new er(this.query,e.ca,s,o,e.mutatedKeys,0===u,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),da:a}:{da:a}}U_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new Nf,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}Ta(e){e&&(e.addedDocuments.forEach(t=>this.oa=this.oa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.oa=this.oa.delete(t)),this.current=e.current)}Ea(){if(!this.current)return[];const e=this.aa;this.aa=B(),this.ca.forEach(r=>{this.Aa(r.key)&&(this.aa=this.aa.add(r.key))});const t=[];return e.forEach(r=>{this.aa.has(r)||t.push(new Ff(r))}),this.aa.forEach(r=>{e.has(r)||t.push(new Of(r))}),t}Ra(e){this.oa=e.hs,this.aa=B();const t=this.ha(e.documents);return this.applyChanges(t,!0)}Va(){return er.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class _I{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class yI{constructor(e){this.key=e,this.ma=!1}}class II{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.fa={},this.ga=new ft(a=>Hh(a),Kr),this.pa=new Map,this.ya=new Set,this.wa=new ee(R.comparator),this.Sa=new Map,this.ba=new Ba,this.Da={},this.Ca=new Map,this.va=un.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}function EI(n,e){return Pu.apply(this,arguments)}function Pu(){return Pu=(0,_.c)(function*(n,e){const t=function Hu(n){const e=A(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Bf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=CI.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=AI.bind(null,e),e.fa.u_=fI.bind(null,e.eventManager),e.fa.xa=mI.bind(null,e.eventManager),e}(n);let r,i;const s=t.ga.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.Va();else{const o=yield function Qn(n,e){const t=A(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Qr.getTargetData(r,e).next(s=>s?(i=s,m.resolve(i)):t.Qr.allocateTargetId(r).next(o=>(i=new pt(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ns.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(r.targetId,r),t.rs.set(e,r.targetId)),r})}(t.localStore,Me(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=yield function Su(n,e,t,r,i){return bu.apply(this,arguments)}(t,e,r,"current"===a,o.resumeToken),t.isPrimaryClient&&Vs(t.remoteStore,o)}return i}),Pu.apply(this,arguments)}function bu(){return bu=(0,_.c)(function*(n,e,t,r,i){n.Ma=(h,f,p)=>{return(E=(0,_.c)(function*(v,D,F,N){let U=D.view.ha(F);U.Xi&&(U=yield Ps(v.localStore,D.query,!1).then(({documents:He})=>D.view.ha(He,U)));const Z=N&&N.targetChanges.get(D.targetId),Y=N&&null!=N.targetMismatches.get(D.targetId),ge=D.view.applyChanges(U,v.isPrimaryClient,Z,Y);return Lu(v,D.targetId,ge.da),ge.snapshot}),function w(v,D,F,N){return E.apply(this,arguments)})(n,h,f,p);var E};const s=yield Ps(n.localStore,e,!0),o=new Lf(e,s.hs),a=o.ha(s.documents),u=ei.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),c=o.applyChanges(a,n.isPrimaryClient,u);Lu(n,t,c.da);const l=new _I(e,t,o);return n.ga.set(e,l),n.pa.has(t)?n.pa.get(t).push(e):n.pa.set(t,[e]),c.snapshot}),bu.apply(this,arguments)}function TI(n,e){return Cu.apply(this,arguments)}function Cu(){return Cu=(0,_.c)(function*(n,e){const t=A(n),r=t.ga.get(e),i=t.pa.get(r.targetId);if(i.length>1)return t.pa.set(r.targetId,i.filter(s=>!Kr(s,e))),void t.ga.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Wn(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),di(t.remoteStore,r.targetId),tr(t,r.targetId)}).catch(At))):(tr(t,r.targetId),yield Wn(t.localStore,r.targetId,!0))}),Cu.apply(this,arguments)}function xu(){return xu=(0,_.c)(function*(n,e,t){const r=function Yu(n){const e=A(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wI.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=RI.bind(null,e),e}(n);try{const i=yield function(o,a){const u=A(o),c=oe.now(),l=a.reduce((p,E)=>p.add(E.key),B());let h,f;return u.persistence.runTransaction("Locally write mutations","readwrite",p=>{let E=Le(),w=B();return u.os.getEntries(p,l).next(v=>{E=v,E.forEach((D,F)=>{F.isValidDocument()||(w=w.add(D))})}).next(()=>u.localDocuments.getOverlayedDocuments(p,E)).next(v=>{h=v;const D=[];for(const F of a){const N=J_(F,h.get(F.key).overlayedDocument);null!=N&&D.push(new mt(F.key,N,kh(N.value.mapValue),se.exists(!0)))}return u.mutationQueue.addMutationBatch(p,c,D,a)}).next(v=>{f=v;const D=v.applyToLocalDocumentSet(h,w);return u.documentOverlayCache.saveOverlays(p,v.batchId,D)})}).then(()=>({batchId:f.batchId,changes:Zh(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Da[o.currentUser.toKey()];c||(c=new ee(M)),c=c.insert(a,u),o.Da[o.currentUser.toKey()]=c}(r,i.batchId,t),yield gt(r,i.changes),yield Yn(r.remoteStore)}catch(i){const s=Xn(i,"Failed to persist write");t.reject(s)}}),xu.apply(this,arguments)}function Bf(n,e){return Vu.apply(this,arguments)}function Vu(){return Vu=(0,_.c)(function*(n,e){const t=A(n);try{const r=yield function qy(n,e){const t=A(n),r=e.snapshotVersion;let i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;const a=[];e.targetChanges.forEach((l,h)=>{const f=i.get(h);if(!f)return;a.push(t.Qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>t.Qr.addMatchingKeys(s,l.addedDocuments,h)));let p=f.withSequenceNumber(s.currentSequenceNumber);var w,v,D;null!==e.targetMismatches.get(h)?p=p.withResumeToken(pe.EMPTY_BYTE_STRING,x.min()).withLastLimboFreeSnapshotVersion(x.min()):l.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(l.resumeToken,r)),i=i.insert(h,p),v=p,D=l,(0===(w=f).resumeToken.approximateByteSize()||v.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8||D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0)&&a.push(t.Qr.updateTargetData(s,p))});let u=Le(),c=B();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(function _f(n,e,t){let r=B(),i=B();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Le();return t.forEach((a,u)=>{const c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(x.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):y("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{cs:o,ls:i}})}(s,o,e.documentUpdates).next(l=>{u=l.cs,c=l.ls})),!r.isEqual(x.min())){const l=t.Qr.getLastRemoteSnapshotVersion(s).next(h=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.ns=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Sa.get(s);o&&(C(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.ma=!0:i.modifiedDocuments.size>0?C(o.ma):i.removedDocuments.size>0&&(C(o.ma),o.ma=!1))}),yield gt(t,r,e)}catch(r){yield At(r)}}),Vu.apply(this,arguments)}function Uf(n,e,t){const r=A(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ga.forEach((s,o)=>{const a=o.view.U_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const u=A(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(const f of h.Q_)f.U_(a)&&(c=!0)}),c&&wu(u)}(r.eventManager,e),i.length&&r.fa.u_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function AI(n,e,t){return Du.apply(this,arguments)}function Du(){return Du=(0,_.c)(function*(n,e,t){const r=A(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Sa.get(e),s=i&&i.key;if(s){let o=new ee(R.comparator);o=o.insert(s,re.newNoDocument(s,x.min()));const a=B().add(s),u=new Zr(x.min(),new Map,new ee(M),o,a);yield Bf(r,u),r.wa=r.wa.remove(s),r.Sa.delete(e),Bu(r)}else yield Wn(r.localStore,e,!1).then(()=>tr(r,e,t)).catch(At)}),Du.apply(this,arguments)}function wI(n,e){return Nu.apply(this,arguments)}function Nu(){return Nu=(0,_.c)(function*(n,e){const t=A(n),r=e.batch.batchId;try{const i=yield function Gy(n,e){const t=A(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){const h=c.batch,f=h.keys();let p=m.resolve();return f.forEach(E=>{p=p.next(()=>l.getEntry(u,E)).next(w=>{const v=c.docVersions.get(E);C(null!==v),w.version.compareTo(v)<0&&(h.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),l.addEntry(w)))})}),p.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=B();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);Fu(t,r,null),Ou(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield gt(t,i)}catch(i){yield At(i)}}),Nu.apply(this,arguments)}function RI(n,e,t){return ku.apply(this,arguments)}function ku(){return ku=(0,_.c)(function*(n,e,t){const r=A(n);try{const i=yield function(o,a){const u=A(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(C(null!==h),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,e);Fu(r,e,t),Ou(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield gt(r,i)}catch(i){yield At(i)}}),ku.apply(this,arguments)}function Ou(n,e){(n.Ca.get(e)||[]).forEach(t=>{t.resolve()}),n.Ca.delete(e)}function Fu(n,e,t){const r=A(n);let i=r.Da[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Da[r.currentUser.toKey()]=i}}function tr(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.pa.get(e))n.ga.delete(r),t&&n.fa.xa(r,t);n.pa.delete(e),n.isPrimaryClient&&n.ba.Vr(e).forEach(r=>{n.ba.containsKey(r)||Gf(n,r)})}function Gf(n,e){n.ya.delete(e.path.canonicalString());const t=n.wa.get(e);null!==t&&(di(n.remoteStore,t),n.wa=n.wa.remove(e),n.Sa.delete(t),Bu(n))}function Lu(n,e,t){for(const r of t)r instanceof Of?(n.ba.addReference(r.key,e),SI(n,r)):r instanceof Ff?(y("SyncEngine","Document no longer in limbo: "+r.key),n.ba.removeReference(r.key,e),n.ba.containsKey(r.key)||Gf(n,r.key)):b()}function SI(n,e){const t=e.key,r=t.path.canonicalString();n.wa.get(t)||n.ya.has(r)||(y("SyncEngine","New document in limbo: "+t),n.ya.add(r),Bu(n))}function Bu(n){for(;n.ya.size>0&&n.wa.size<n.maxConcurrentLimboResolutions;){const e=n.ya.values().next().value;n.ya.delete(e);const t=new R(G.fromString(e)),r=n.va.next();n.Sa.set(r,new yI(t)),n.wa=n.wa.insert(t,r),Vs(n.remoteStore,new pt(Me(kn(t.path)),r,"TargetPurposeLimboResolution",ze._e))}}function gt(n,e,t){return Uu.apply(this,arguments)}function Uu(){return Uu=(0,_.c)(function*(n,e,t){const r=A(n),i=[],s=[],o=[];var a;r.ga.isEmpty()||(r.ga.forEach((a,u)=>{o.push(r.Ma(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);const l=ja.Ki(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.fa.u_(i),yield(a=(0,_.c)(function*(c,l){const h=A(c);try{yield h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>m.forEach(l,p=>m.forEach(p.qi,E=>h.persistence.referenceDelegate.addReference(f,p.targetId,E)).next(()=>m.forEach(p.Qi,E=>h.persistence.referenceDelegate.removeReference(f,p.targetId,E)))))}catch(f){if(!wt(f))throw f;y("LocalStore","Failed to update sequence numbers: "+f)}for(const f of l){const p=f.targetId;if(!f.fromCache){const E=h.ns.get(p),v=E.withLastLimboFreeSnapshotVersion(E.snapshotVersion);h.ns=h.ns.insert(p,v)}}}),function u(c,l){return a.apply(this,arguments)})(r.localStore,s))}),Uu.apply(this,arguments)}function bI(n,e){return Gu.apply(this,arguments)}function Gu(){return Gu=(0,_.c)(function*(n,e){const t=A(n);if(!t.currentUser.isEqual(e)){y("SyncEngine","User change. New user:",e.toKey());const r=yield pf(t.localStore,e);t.currentUser=e,(s=t).Ca.forEach(a=>{a.forEach(u=>{u.reject(new I(g.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Ca.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield gt(t,r.us)}var s}),Gu.apply(this,arguments)}function CI(n,e){const t=A(n),r=t.Sa.get(e);if(r&&r.ma)return B().add(r.key);{let i=B();const s=t.pa.get(e);if(!s)return i;for(const o of s){const a=t.ga.get(o);i=i.unionWith(a.view.la)}return i}}class nr{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,_.c)(function*(){t.serializer=li(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function mf(n,e,t,r){return new Uy(n,e,t,r)}(this.persistence,new ff,e.initialUser,this.serializer)}createPersistence(e){return new Ua(As.Hr,this.serializer)}createSharedClientState(e){return new Af}terminate(){var e=this;return(0,_.c)(function*(){var t,r;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(r=e.indexBackfillerScheduler)||void 0===r||r.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class rr{initialize(e,t){var r=this;return(0,_.c)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>Uf(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=bI.bind(null,r.syncEngine),yield function _u(n,e){return yu.apply(this,arguments)}(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new dI}createDatastore(e){const t=li(e.databaseInfo.databaseId),r=new Hy(e.databaseInfo);return new Xy(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,o=t=>Uf(this.syncEngine,t,0),a=wf.D()?new wf:new Ky,new tI(r,i,s,o,a);var r,i,s,o,a}createSyncEngine(e,t){return function(i,s,o,a,u,c,l){const h=new II(i,s,o,a,u,c);return l&&(h.Fa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,_.c)(function*(){var t,r;yield(r=(0,_.c)(function*(s){const o=A(s);y("RemoteStore","RemoteStore shutting down."),o.v_.add(5),yield Hn(o),o.M_.shutdown(),o.x_.set("Unknown")}),function i(s){return r.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate()})()}}class Ns{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ba(this.observer.next,e)}error(e){this.observer.error?this.Ba(this.observer.error,e):ce("Uncaught Error in snapshot listener:",e.toString())}La(){this.muted=!0}Ba(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class qI{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ie.UNAUTHENTICATED,this.clientId=lh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,_.c)(function*(a){y("FirestoreClient","Received user=",a.uid),yield s.authCredentialListener(a),s.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(y("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new I(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new me;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,_.c)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Xn(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function ks(n,e){return Xu.apply(this,arguments)}function Xu(){return Xu=(0,_.c)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),y("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,_.c)(function*(s){r.isEqual(s)||(yield pf(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),Xu.apply(this,arguments)}function Zu(n,e){return ec.apply(this,arguments)}function ec(){return ec=(0,_.c)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield function tc(n){return nc.apply(this,arguments)}(n);y("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Df(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Df(e.remoteStore,i)),n._onlineComponents=e}),ec.apply(this,arguments)}function nc(){return nc=(0,_.c)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){y("FirestoreClient","Using user provided OfflineComponentProvider");try{yield ks(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function Kf(n){return"FirebaseError"===n.name?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}(t))throw t;Ge("Error using user provided cache. Falling back to memory cache: "+t),yield ks(n,new nr)}}else y("FirestoreClient","Using default OfflineComponentProvider"),yield ks(n,new nr);return n._offlineComponents}),nc.apply(this,arguments)}function Ms(n){return rc.apply(this,arguments)}function rc(){return rc=(0,_.c)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(y("FirestoreClient","Using user provided OnlineComponentProvider"),yield Zu(n,n._uninitializedComponentsProvider._online)):(y("FirestoreClient","Using default OnlineComponentProvider"),yield Zu(n,new rr))),n._onlineComponents}),rc.apply(this,arguments)}function sr(n){return sc.apply(this,arguments)}function sc(){return sc=(0,_.c)(function*(n){const e=yield Ms(n),t=e.eventManager;return t.onListen=EI.bind(null,e.syncEngine),t.onUnlisten=TI.bind(null,e.syncEngine),t}),sc.apply(this,arguments)}function Xf(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const Zf=new Map;function oc(n,e,t){if(!t)throw new I(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function em(n){if(!R.isDocumentKey(n))throw new I(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function tm(n){if(R.isDocumentKey(n))throw new I(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Os(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":b()}function z(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new I(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Os(n);throw new I(g.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}class rm{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new I(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new I(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function ZI(n,e,t,r){if(!0===e&&!0===r)throw new I(g.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Xf(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new I(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new I(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new I(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class fi{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new rm({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new I(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new I(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new rm(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new Jg;switch(r.type){case"firstParty":return new t_(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new I(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Zf.get(t);r&&(y("ComponentProvider","Removing Datastore"),Zf.delete(t),r.terminate())}(this),Promise.resolve()}}class Se{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Se(this.firestore,e,this._query)}}class he{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new at(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new he(this.firestore,e,this._key)}}class at extends Se{constructor(e,t,r){super(e,t,kn(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new he(this.firestore,null,new R(e))}withConverter(e){return new at(this.firestore,e,this._path)}}function ac(n,e,...t){if(n=Ke(n),oc("collection","path",e),n instanceof fi){const r=G.fromString(e,...t);return tm(r),new at(n,null,r)}{if(!(n instanceof he||n instanceof at))throw new I(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(G.fromString(e,...t));return tm(r),new at(n.firestore,null,r)}}function uc(n,e,...t){if(n=Ke(n),1===arguments.length&&(e=lh.newId()),oc("doc","path",e),n instanceof fi){const r=G.fromString(e,...t);return em(r),new he(n,null,new R(r))}{if(!(n instanceof he||n instanceof at))throw new I(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(G.fromString(e,...t));return em(r),new he(n.firestore,n instanceof at?n.converter:null,new R(r))}}class tE{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new eu(this,"async_queue_retry"),this._u=()=>{const t=xs();t&&y("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};const e=xs();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.au(),this.uu(e)}enterRestrictedMode(e){if(!this.tu){this.tu=!0,this.su=e||!1;const t=xs();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._u)}}enqueue(e){if(this.au(),this.tu)return new Promise(()=>{});const t=new me;return this.uu(()=>this.tu&&this.su?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.eu.push(e),this.cu()))}cu(){var e=this;return(0,_.c)(function*(){if(0!==e.eu.length){try{yield e.eu[0](),e.eu.shift(),e.jo.reset()}catch(t){if(!wt(t))throw t;y("AsyncQueue","Operation failed with retryable error: "+t)}e.eu.length>0&&e.jo.qo(()=>e.cu())}})()}uu(e){const t=this.Xa.then(()=>(this.iu=!0,e().catch(r=>{throw this.ru=r,this.iu=!1,ce("INTERNAL UNHANDLED ERROR: ",function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),a}(r)),r}).then(r=>(this.iu=!1,r))));return this.Xa=t,t}enqueueAfterDelay(e,t,r){this.au(),this.ou.indexOf(e)>-1&&(t=0);const i=Iu.createAndSchedule(this,e,t,r,s=>this.lu(s));return this.nu.push(i),i}au(){this.ru&&b()}verifyOperationInProgress(){}hu(){var e=this;return(0,_.c)(function*(){let t;do{t=e.Xa,yield t}while(t!==e.Xa)})()}Pu(e){for(const t of this.nu)if(t.timerId===e)return!0;return!1}Iu(e){return this.hu().then(()=>{this.nu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.nu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.hu()})}Tu(e){this.ou.push(e)}lu(e){const t=this.nu.indexOf(e);this.nu.splice(t,1)}}function cc(n){return function(t,r){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class te extends fi{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new tE,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||sm(this),this._firestoreClient.terminate()}}function rE(n,e){const t="object"==typeof n?n:function Np(n=Ri){const e=zt.get(n);if(!e&&n===Ri&&vi())return Lc();if(!e)throw ut.create("no-app",{appName:n});return e}(),r="string"==typeof n?n:e||"(default)",i=function Fc(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=(n=>{const e=(n=>{var e,t;return null===(t=null===(e=pn())||void 0===e?void 0:e.emulatorHosts)||void 0===t?void 0:t[n]})(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return"["===e[0]?[e.substring(1,t-1),r]:[e.substring(0,t),r]})("firestore");s&&function eE(n,e,t,r={}){var i;const s=(n=z(n,fi))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Ge("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if("string"==typeof r.mockUserToken)a=r.mockUserToken,u=Ie.MOCK_USER;else{a=function no(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[je(JSON.stringify({alg:"none",type:"JWT"})),je(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new I(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Ie(c)}n._authCredentials=new Xg(new uh(a,u))}}(i,...s)}return i}function de(n){return n._firestoreClient||sm(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function sm(n){var e,t,r;const i=n._freezeSettings(),s=(u=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new x_(n._databaseId,u,n._persistenceKey,(l=i).host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Xf(l.experimentalLongPollingOptions),l.useFetchStreams));var u,l;n._firestoreClient=new qI(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class ln{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ln(pe.fromBase64String(e))}catch(t){throw new I(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ln(pe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class hn{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new I(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ie(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class or{constructor(e){this._methodName=e}}class lc{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new I(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new I(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return M(this._lat,e._lat)||M(this._long,e._long)}}const sE=/^__.*__$/;class oE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new mt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Bn(e,this.data,t,this.fieldTransforms)}}function cm(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw b()}}class Fs{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.Eu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(e){return new Fs(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Au({path:r,Vu:!1});return i.mu(e),i}fu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Au({path:r,Vu:!1});return i.Eu(),i}gu(e){return this.Au({path:void 0,Vu:!0})}pu(e){return Us(e,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Eu(){if(this.path)for(let e=0;e<this.path.length;e++)this.mu(this.path.get(e))}mu(e){if(0===e.length)throw this.pu("Document fields must not be empty");if(cm(this.du)&&sE.test(e))throw this.pu('Document fields cannot begin and end with "__"')}}class aE{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||li(e)}Su(e,t,r,i=!1){return new Fs({du:e,methodName:t,wu:r,path:ie.emptyPath(),Vu:!1,yu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function dn(n){const e=n._freezeSettings(),t=li(n._databaseId);return new aE(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ls(n,e,t,r,i,s={}){const o=n.Su(s.merge||s.mergeFields?2:0,e,t,i);_c("Data must be an object, but it was:",o,r);const a=dm(r,o);let u,c;if(s.merge)u=new Fe(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const l=[];for(const h of s.mergeFields){const f=gi(e,h,t);if(!o.contains(f))throw new I(g.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);mm(l,f)||l.push(f)}u=new Fe(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new oE(new Pe(a),u,c)}function fn(n,e){if(fm(n=Ke(n)))return _c("Unsupported field value:",e,n),dm(n,e);if(n instanceof or)return function(r,i){if(!cm(i.du))throw i.pu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.pu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Vu&&4!==e.du)throw e.pu("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let u=fn(a,i.gu(o));null==u&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=Ke(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return rd(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=oe.fromDate(r);return{timestampValue:Gn(i.serializer,s)}}if(r instanceof oe){const s=new oe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Gn(i.serializer,s)}}if(r instanceof lc)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ln)return{bytesValue:wd(i.serializer,r._byteString)};if(r instanceof he){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.pu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Sa(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.pu(`Unsupported field value: ${Os(r)}`)}(n,e)}function dm(n,e){const t={};return Rh(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Rt(n,(r,i)=>{const s=fn(i,e.Ru(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function fm(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof oe||n instanceof lc||n instanceof ln||n instanceof he||n instanceof or)}function _c(n,e,t){if(!fm(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=Os(t);throw e.pu("an object"===r?n+" a custom object":n+" "+r)}var i}function gi(n,e,t){if((e=Ke(e))instanceof hn)return e._internalPath;if("string"==typeof e)return Bs(n,e);throw Us("Field path arguments must be of type string or ",n,!1,void 0,t)}const uE=new RegExp("[~\\*/\\[\\]]");function Bs(n,e,t){if(e.search(uE)>=0)throw Us(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new hn(...e.split("."))._internalPath}catch{throw Us(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Us(n,e,t,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new I(g.INVALID_ARGUMENT,a+n+u)}function mm(n,e){return n.some(t=>t.isEqual(e))}class _i{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new he(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new cE(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Gs("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class cE extends _i{data(){return super.data()}}function Gs(n,e){return"string"==typeof e?Bs(n,e):e instanceof hn?e._internalPath:e._delegate._internalPath}function pm(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new I(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Tm{convertValue(e,t="none"){switch(bt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ue(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ht(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw b()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Rt(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new lc(ue(e.latitude),ue(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=is(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ur(e));default:return null}}convertTimestamp(e){const t=Pt(e);return new oe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=G.fromString(e);C(Md(r));const i=new Jt(r.get(1),r.get(3)),s=new R(r.popFirst(5));return i.isEqual(t)||ce(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function $s(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class mn{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ur extends _i{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ks(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Gs("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Ks extends ur{data(e={}){return super.data(e)}}class cr{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new mn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ks(this._firestore,this._userDataWriter,r.key,r,new mn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new I(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>({type:"added",doc:new Ks(i._firestore,i._userDataWriter,a.doc.key,a.doc,new mn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||3!==a.type).map(a=>{const u=new Ks(i._firestore,i._userDataWriter,a.doc.key,a.doc,new mn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,l=-1;return 0!==a.type&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),1!==a.type&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:dE(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function dE(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return b()}}class Ft extends Tm{constructor(e){super(),this.firestore=e}convertBytes(e){return new ln(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new he(this.firestore,null,t)}}function Ei(n,e){return function(r,i){const s=new me;return r.asyncQueue.enqueueAndForget((0,_.c)(function*(){return function vI(n,e,t){return xu.apply(this,arguments)}(yield function ic(n){return Ms(n).then(e=>e.syncEngine)}(r),i,s)})),s.promise}(de(n),e)}!function(e,t=!0){Pn="10.8.0",Si(new dr("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new te(new Zg(r.getProvider("auth-internal")),new n_(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new I(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Jt(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),yn(ah,"4.4.2",e),yn(ah,"4.4.2","esm2017")}();var xE=X(5724),VE=X(7458);let DE=(()=>{class n{constructor(){var t=this;this.firebase=Lc(ve.O.firebaseConfig),this.database=rE(this.firebase),this.collections$={},this.collections={},this.subs=[],this.subscription=function(){var r=(0,_.c)(function*(i,s){return function _E(n,...e){var t,r,i;n=Ke(n);let s={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||cc(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(cc(e[o])){const h=e[o];e[o]=null===(t=h.next)||void 0===t?void 0:t.bind(h),e[o+1]=null===(r=h.error)||void 0===r?void 0:r.bind(h),e[o+2]=null===(i=h.complete)||void 0===i?void 0:i.bind(h)}let u,c,l;if(n instanceof he)c=z(n.firestore,te),l=kn(n._key.path),u={next:h=>{e[o]&&e[o](function Ec(n,e,t){const r=t.docs.get(e._key),i=new Ft(n);return new ur(n,i,e._key,r,new mn(t.hasPendingWrites,t.fromCache),e.converter)}(c,n,h))},error:e[o+1],complete:e[o+2]};else{const h=z(n,Se);c=z(h.firestore,te),l=h._query;const f=new Ft(c);u={next:p=>{e[o]&&e[o](new cr(c,f,h,p))},error:e[o+1],complete:e[o+2]},pm(n._query)}return function(f,p,E,w){const v=new Ns(w),D=new Ru(p,v,E);return f.asyncQueue.enqueueAndForget((0,_.c)(function*(){return Eu(yield sr(f),D)})),()=>{v.La(),f.asyncQueue.enqueueAndForget((0,_.c)(function*(){return vu(yield sr(f),D)}))}}(de(c),l,a,u)}(ac(t.database,i.toLowerCase()),a=>{s&&s(i)})});return function(i,s){return r.apply(this,arguments)}}()}ngOnDestroy(){this.subs.forEach(t=>t.Unsubscribe())}getCollection(t){return this.collections[t]||this.subscriptionCreate(t),this.collections[t]}subscriptionCreate(t){this.collections$[t]=new xE.E,this.collections[t]=this.collections$[t].asObservable(),this.subs.push(this.subscription(t,()=>{this.updateCollection(t)}))}updateCollection(t){var r=this;return(0,_.c)(function*(){r.collections$[t].next(yield r.getAllDocuments(t))})()}addNewDocument(t,r){var i=this;return(0,_.c)(function*(){try{return yield function gE(n,e){const t=z(n.firestore,te),r=uc(n),i=$s(n.converter,e);return Ei(t,[Ls(dn(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,se.exists(!1))]).then(()=>r)}(ac(i.database,t),r)}catch(s){return console.error("Error adding document: ",s),null}})()}setDocument(t,r,i){var s=this;return(0,_.c)(function*(){try{const o=uc(s.database,t,r);return yield function mE(n,e,t){n=z(n,he);const r=z(n.firestore,te),i=$s(n.converter,e,t);return Ei(r,[Ls(dn(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,se.none())])}(o,i)}catch(o){return console.error("error setting document: ",o),null}})()}getAllDocuments(t){var r=this;return(0,_.c)(function*(){try{const i=[];return(yield function fE(n){n=z(n,Se);const e=z(n.firestore,te),t=de(e),r=new Ft(e);return pm(n._query),function Jf(n,e,t={}){const r=new me;return n.asyncQueue.enqueueAndForget((0,_.c)(function*(){return function(s,o,a,u,c){const l=new Ns({next:f=>{o.enqueueAndForget(()=>vu(s,h)),f.fromCache&&"server"===u.source?c.reject(new I(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(f)},error:f=>c.reject(f)}),h=new Ru(a,l,{includeMetadataChanges:!0,Z_:!0});return Eu(s,h)}(yield sr(n),n.asyncQueue,e,t,r)})),r.promise}(t,n._query).then(i=>new cr(e,r,n,i))}(ac(r.database,t))).forEach(o=>{i.push({id:o.id,...o.data()})}),i}catch(i){return console.error("Error getting documents: ",i),null}})()}deleteDocument(t,r){var i=this;return(0,_.c)(function*(){try{const s=uc(i.database,t,r);return yield function pE(n){return Ei(z(n.firestore,te),[new Un(n._key,se.none())])}(s)}catch(s){return console.error("Error deleting document: ",s),null}})()}static#e=this.\u0275fac=function(r){return new(r||n)};static#t=this.\u0275prov=VE.wxM({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})()},6528:(Ws,Bt,X)=>{X.d(Bt,{k:()=>Ut});var _=X(3864),ve=X(2644),d=X(5648),_t=X(7458);let Ut=(()=>{class Oe{static#e=this.\u0275fac=function(yt){return new(yt||Oe)};static#t=this.\u0275mod=_t.a4G({type:Oe});static#n=this.\u0275inj=_t.s3X({imports:[d.wZ,_.MD,ve.y]})}return Oe})()}}]);